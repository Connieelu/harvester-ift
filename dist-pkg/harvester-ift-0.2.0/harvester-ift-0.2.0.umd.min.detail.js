(("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_2_0"]=("undefined"!==typeof self?self:this)["webpackJsonpharvester_ift_0_2_0"]||[]).push([[4],{"08d6":function(e,t,a){"use strict";a("da72")},"0e4c":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("Loading",{attrs:{mode:"relative",loading:e.loading}}),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hav-storage"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.storage.storageClass.label"),value:e.value.storageClassName,mode:e.mode}},[t("LabeledSelect",{attrs:{options:e.storageClassOptions,label:e.t("harvester.storage.storageClass.label"),mode:e.mode,disabled:e.isDisabled,required:e.validateRequired},on:{input:e.update},model:{value:e.value.storageClassName,callback:function(t){e.$set(e.value,"storageClassName",t)},expression:"value.storageClassName"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hev-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,mode:e.mode,min:10,required:e.validateRequired,label:e.t("harvester.fields.size")},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hev-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption,required:""},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])],1)},i=[],r=a("15ca"),l=a("4978"),n=a("5361"),o=a("8e93"),d=a("466b"),u=a("907c"),c=a("d37d"),p=a("7c47"),v=a("90cd"),m={name:"HarvesterEditVolume",components:{InputOrDisplay:n["a"],Loading:r["a"],LabeledInput:o["a"],LabeledSelect:d["a"],UnitInput:l["a"]},props:{mode:{type:String,default:"create"},isEdit:{type:Boolean,default:!1},value:{type:Object,default:()=>({})},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:p["e"],InterfaceOption:p["b"],loading:!1}},computed:{pvcsResource(){const e=this.$store.getters[v["b"]+"/all"](u["y"])||[];return e.find(e=>e.metadata.name===this.value.volumeName)},isDisabled(){return!this.value.newCreateId&&this.isEdit&&this.isVirtualType},storageClassOptions(){const e=this.$store.getters[v["b"]+"/all"](u["F"])||[],t=e.filter(e=>{var t;return!(null!==(t=e.parameters)&&void 0!==t&&t.backingImage)}).map(e=>{const t=e.isDefault?`${e.name} (${this.t("generic.default")})`:e.name;return{label:t,value:e.name}})||[];return t}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},pvcsResource:{handler(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.spec)&&void 0!==t&&null!==(t=t.resources)&&void 0!==t&&null!==(t=t.requests)&&void 0!==t&&t.storage){const t=Object(c["d"])(e.spec.resources.requests.storage),a=Object(c["c"])(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=a+"Gi"}},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")}}},h=m,f=a("d802"),b=Object(f["a"])(h,s,i,!1,null,null,null);t["default"]=b.exports},"0f89":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-e1902d82] .labeled-select .v-select:not(.vs--single) .vs__selected-options{flex-basis:auto;flex-wrap:wrap;width:100%}[data-v-e1902d82] .labeled-select .v-select:not(.vs--single) .vs__selected{white-space:nowrap}",""]),e.exports=t},"100f":function(e,t,a){var s=a("ad6d");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("203d7468",s,!0,{sourceMap:!1,shadowMode:!1})},1046:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".dashboard-metrics[data-v-1e72d538] .external-link{position:absolute;left:200px;top:-45px}.dashboard-metrics[data-v-1e72d538] .frame{top:0}.dashboard-metrics.external-link-pull-left[data-v-1e72d538] .external-link{position:absolute;left:10px;top:-47px}",""]),e.exports=t},1234:function(e,t,a){var s=a("a9ed");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("3bcf674f",s,!0,{sourceMap:!1,shadowMode:!1})},"1a25":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("Tabbed",e._b({staticClass:"mt-15",attrs:{"side-tabs":!0}},"Tabbed",e.$attrs,!1),[t("Tab",{staticClass:"bordered-table",attrs:{name:"detail",label:e.t("harvester.virtualMachine.detail.tabs.basics"),weight:99}},[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[e.isUpload?t("LabelValue",{staticClass:"mb-20",attrs:{name:e.t("harvester.image.fileName"),value:e.imageName}}):t("LabelValue",{staticClass:"mb-20",attrs:{name:e.t("harvester.image.url"),value:e.url},scopedSlots:e._u([{key:"value",fn:function(){return["-"!==e.url?t("div",[t("CopyToClipboardText",{attrs:{text:e.url}})],1):t("div",[e._v(" "+e._s(e.url)+" ")])]},proxy:!0}])})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("LabelValue",{staticClass:"mb-20",attrs:{name:e.t("harvester.image.size"),value:e.formattedValue}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("LabelValue",{staticClass:"mb-20",attrs:{name:e.t("nameNsDescription.description.label"),value:e.description}})],1)]),"-"!==e.errorMessage?t("div",{staticClass:"row"},[t("div",{staticClass:"col span-12"},[t("div",[e._v(" "+e._s(e.t("tableHeaders.message"))+" ")]),t("div",{class:{error:"-"!==e.errorMessage}},[e._v(" "+e._s(e.errorMessage)+" ")])])]):e._e()])],1)},i=[],r=function(){var e=this,t=e._self._c;return t("a",{staticClass:"copy-to-clipboard-text",class:{copied:e.copied,plain:e.plain},attrs:{href:"#"},on:{click:e.clicked}},[e._v(" "+e._s(e.text)+" "),t("i",{staticClass:"icon",class:{"icon-copy":!e.copied,"icon-checkmark":e.copied}})])},l=[],n={props:{text:{type:String,required:!0},plain:{type:Boolean,default:!1}},data(){return{copied:!1}},methods:{clicked(e){if(!this.copied){e.preventDefault(),this.$copyText(this.text),this.copied=!0;let t=e.target;"I"===t.tagName&&(t=t.parentElement||t),setTimeout(()=>{this.copied=!1},500)}}}},o=n,d=(a("8058"),a("d802")),u=Object(d["a"])(o,r,l,!1,null,"f6a2b8be",null),c=u.exports,p=a("8133"),v=a("4ac6"),m=a("873f"),h=a("0cb2"),f=a("38de"),b=a("bddd"),g=a("e24b"),y={components:{CopyToClipboardText:c,Tab:f["a"],Tabbed:h["a"],LabelValue:p["a"]},props:{value:{type:Object,required:!0}},data(){return{}},computed:{formattedValue(){var e;return null===(e=this.value)||void 0===e?void 0:e.downSize},url(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.url)||"-"},description(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[v["e"]])||"-"},errorMessage(){var e;const t=Object(g["g"])(this.value,"status.conditions");return(null===(e=Object(b["e"])(t,"type","Imported"))||void 0===e?void 0:e.message)||"-"},isUpload(){var e;return"upload"===(null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.sourceType)},imageName(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[m["a"].IMAGE_NAME])||"-"}}},w=y,S=(a("08d6"),Object(d["a"])(w,s,i,!1,null,"295e0aeb",null));t["default"]=S.exports},"1eec":function(e,t,a){var s=a("77f0");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("35c1aaaa",s,!0,{sourceMap:!1,shadowMode:!1})},"201a":function(e,t,a){"use strict";a("62d1")},"20a9":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".overview-web-console .btn{line-height:24px;min-height:24px}",""]),e.exports=t},"2a79":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.input.sshKey"),taggable:!0,mode:e.mode,multiple:!0,searchable:e.searchable,disabled:e.disabled,options:e.sshOption},on:{input:e.update},model:{value:e.checkedSsh,callback:function(t){e.checkedSsh=t},expression:"checkedSsh"}}),t("ModalWithCard",{ref:e.randomStr,attrs:{name:e.randomStr,width:"40%",errors:e.errors},on:{finish:e.save,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.sshTitle"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.name"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.sshName,callback:function(t){e.sshName=t},expression:"sshName"}}),t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.sshKeyValue"),"min-height":160,type:"multiline",required:""},model:{value:e.publicKey,callback:function(t){e.publicKey=t},expression:"publicKey"}})]},proxy:!0}])})],1)},i=[],r=a("9ce4"),l=a("2cb5"),n=a("8e93"),o=a("466b"),d=a("977e"),u=a("90cd"),c=a("e24b"),p=a("da25");const v="_NEW";var m={components:{LabeledInput:n["a"],ModalWithCard:d["a"],LabeledSelect:o["a"]},props:{value:{type:Array,default:()=>[]},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},namespace:{type:String,default:""},searchable:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},data(){return{checkedSsh:this.value,publicKey:"",sshName:"",randomStr:Object(l["p"])(5).toLowerCase(),errors:[],isAll:!1,checkAll:!1}},computed:{...Object(r["a"])({t:"i18n/t"}),schema(){return this.$store.getters[u["b"]+"/schemaFor"](u["a"].SSH)},isCreatable(){var e;return!(this.schema&&(null===(e=this.schema)||void 0===e||!e.collectionMethods.find(e=>["blocked-post","post"].includes(e.toLowerCase()))))},sshOption(){const e=this.$store.getters[u["b"]+"/all"](u["a"].SSH).map(e=>({label:e.id,value:e.id}));return!this.disableCreate&&this.mode!==p["w"]&&this.isCreatable&&e.unshift({label:this.t("harvester.virtualMachine.createSSHKey"),value:v}),e}},watch:{publicKey(e){const t=e.split(/\s+/);3===t.length&&t[2].includes("@")&&t[2].split("@")&&(this.sshName||(this.sshName=t[2].split("@")[0]))},value(e){this.checkedSsh=e},checkedSsh(e,t){e.includes(v)&&(this.$set(this,"checkedSsh",t),this.update(),this.show())}},methods:{show(){this.$modal.show(this.randomStr)},hide(){this.$modal.hide(this.randomStr)},async save(e){if(this.errors=[],!this.sshName){const e=this.t("harvester.virtualMachine.input.name"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(!this.publicKey){const e=this.t("harvester.virtualMachine.input.sshKeyValue"),t=this.t("validation.required",{key:e});this.errors.push(t)}if(this.sshName.length>63){const e=this.t("harvester.validation.custom.tooLongName",{max:63});this.errors.push(e)}if(this.errors.length>0)e(!1);else try{const t=await this.$store.dispatch(u["b"]+"/create",{metadata:{name:this.sshName,namespace:this.namespace},spec:{publicKey:this.publicKey},type:u["a"].SSH}),a=await t.save();a.id&&this.checkedSsh.push(`${this.namespace}/${this.sshName}`),e(!0),this.cancel()}catch(t){this.errors=[t.message],e(!1)}},cancel(){this.hide(),this.resetFields()},resetFields(){this.sshName="",this.publicKey="",this.errors=[]},update(){this.$emit("update:sshKey",Object(c["e"])(this.checkedSsh))}}},h=m,f=(a("201a"),a("d802")),b=Object(f["a"])(h,s,i,!1,null,"e1902d82",null);t["a"]=b.exports},"2e9d":function(e,t,a){"use strict";a("fbc9")},3823:function(e,t,a){"use strict";a("58cd")},"38d5":function(e,t,a){"use strict";a("aa1e")},"411b":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"vm__credentials-users"},[t("LabeledSelect",{class:{hasUsers:e.selectedUser.length>0},attrs:{options:e.userOptions,label:e.t("harvester.virtualMachine.accessCredentials.injectSSH.users"),taggable:e.multiple,mode:e.mode,multiple:e.multiple,searchable:!1,tooltip:e.t("harvester.virtualMachine.accessCredentials.userTips")},on:{input:e.update},model:{value:e.selectedUser,callback:function(t){e.selectedUser=t},expression:"selectedUser"}}),t("ModalWithCard",{ref:e.randomStr,attrs:{name:e.randomStr,width:"40%",errors:e.errors},on:{finish:e.addUser,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.username"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.newUsername,callback:function(t){e.newUsername=t},expression:"newUsername"}})]},proxy:!0}])})],1)},i=[],r=a("9ce4"),l=a("e24b"),n=a("2cb5"),o=a("8e93"),d=a("466b"),u=a("977e");const c="_NEW";var p={components:{LabeledInput:o["a"],LabeledSelect:d["a"],ModalWithCard:u["a"]},props:{value:{type:[Array,String],default:()=>[]},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},multiple:{type:Boolean,default:!1},mode:{type:String,default:"create"},disabled:{type:Boolean,default:!1}},data(){return{selectedUser:this.value,newUsername:"",randomStr:Object(n["p"])(5).toLowerCase(),errors:[]}},computed:{...Object(r["a"])({t:"i18n/t"})},watch:{value(e){this.selectedUser=e},selectedUser(e,t){e.includes(c)&&(this.$set(this,"selectedUser",t),this.update(),this.show())}},methods:{update(){this.$emit("update:user",Object(l["e"])(this.selectedUser))},addUser(e){const t=/^[-._0-9a-zA-Z]+$/;if(this.errors=[],!t.test(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.invalidUser");return this.errors.push(t),void e(!1)}if(this.userOptions.includes(this.newUsername)){const t=this.t("harvester.virtualMachine.accessCredentials.duplicatedUser");return this.errors.push(t),void e(!1)}this.multiple?this.selectedUser.push(this.newUsername):this.selectedUser=this.newUsername,this.$emit("update:newUser",this.newUsername),this.update(),e(!0),this.cancel()},show(){this.$modal.show(this.randomStr)},hide(){this.$modal.hide(this.randomStr)},cancel(){this.hide(),this.newUsername=""}}},v=p,m=(a("5cb0"),a("d802")),h=Object(m["a"])(v,s,i,!1,null,null,null);t["a"]=h.exports},4890:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),mode:e.mode,options:e.VOLUME_TYPE,required:""},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-volumeName"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.volume"),value:e.value.volumeName,mode:e.mode}},[t("LabeledSelect",{attrs:{disabled:e.isDisabled,label:e.t("harvester.fields.volume"),mode:e.mode,options:e.volumeOption,required:""},on:{input:e.update},model:{value:e.value.volumeName,callback:function(t){e.$set(e.value,"volumeName",t)},expression:"value.volumeName"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:e.mode,disabled:!0},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[e.image?t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-image"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.image"),value:e.image,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.image"),mode:e.mode,disabled:!0},on:{input:e.update},model:{value:e.image,callback:function(t){e.image=t},expression:"image"}})],1)],1):e._e(),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hee-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption,disabled:!0,required:""},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],r=a("4978"),l=a("8e93"),n=a("466b"),o=a("5361"),d=a("1d19"),u=a("907c"),c=a("90cd"),p=a("da25"),v=a("7c47"),m=a("873f"),h={name:"HarvesterEditExisting",components:{UnitInput:r["a"],LabeledInput:l["a"],LabeledSelect:n["a"],InputOrDisplay:o["a"]},props:{mode:{type:String,default:p["n"]},value:{type:Object,required:!0},isEdit:{type:Boolean,default:!1},namespace:{type:String,default:null},idx:{type:Number,default:0},rows:{type:Array,required:!0}},data(){return this.value.realName&&(this.value.volumeName=this.value.realName),{VOLUME_TYPE:v["e"],InterfaceOption:v["b"],loading:!1}},computed:{isDisabled(){return!this.value.newCreateId&&this.isEdit},allPVCs(){const e=this.$store.getters[c["b"]+"/all"](u["y"]);return e.filter(e=>!this.namespace||this.namespace===e.metadata.namespace)||[]},image(){const e=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE).find(e=>{var t;return e.id===(null===(t=this.pvcResource)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[m["a"].IMAGE_ID])});if(e)return`${e.metadata.namespace}/${e.spec.displayName}`},pvcResource(){return this.allPVCs.find(e=>e.metadata.name===this.value.volumeName)},volumeOption(){return Object(d["a"])(this.allPVCs.filter(e=>{var t,a,s,i;let r=!0,l=!1,n=!1;if(this.rows.forEach(t=>{t.volumeName===e.metadata.name&&(r=!1)}),0===this.idx&&(null===(t=e.metadata)||void 0===t||null===(t=t.annotations)||void 0===t||!t[m["a"].IMAGE_ID]))return!1;if(e.attachVM&&r&&(null===(a=e.attachVM)||void 0===a?void 0:a.id)===(null===(s=this.vm)||void 0===s?void 0:s.id)&&this.isEdit?l=!1:e.attachVM&&(l=!0),null!==e&&void 0!==e&&null!==(i=e.metadata)&&void 0!==i&&null!==(i=i.annotations)&&void 0!==i&&i[m["a"].VOLUME_VM]){var o;const t=JSON.parse(null===e||void 0===e||null===(o=e.metadata)||void 0===o||null===(o=o.annotations)||void 0===o?void 0:o[m["a"].VOLUME_VM]).type;n="disk"===t}return r&&!l&&e.isAvailable&&n}).map(e=>({label:e.metadata.name,value:e.metadata.name})),"label")}},watch:{"value.volumeName"(e){const t=this.allPVCs.find(t=>t.metadata.name===e);t&&(this.value.accessModes=t.spec.accessModes[0],this.value.size=t.spec.resources.requests.storage,this.value.storageClassName=t.spec.storageClassName,this.value.volumeMode=t.spec.volumeMode)},"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},pvcResource:{handler(e){var t;!this.value.volumeName&&null!==e&&void 0!==e&&null!==(t=e.metadata)&&void 0!==t&&t.name&&(this.value.volumeName=e.metadata.name)},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")}}},f=h,b=a("d802"),g=Object(b["a"])(f,s,i,!1,null,null,null);t["default"]=g.exports},"4b06":function(e,t,a){"use strict";a.d(t,"a",(function(){return m})),a.d(t,"b",(function(){return f}));var s=a("e3b5"),i=a.n(s),r=a("7838"),l=a.n(r),n=a("9e74"),o=a.n(n),d=a("e24b"),u=a("907c"),c=a("90cd"),p=a("873f"),v=a("6834");const m={package_update:!0,packages:["qemu-guest-agent"],runcmd:[["systemctl","enable","--now","qemu-guest-agent.service"]]},h={default:"qemu-guest-agent.service"},f=[{bus:"usb",name:"tablet",type:"tablet"}],b={EXISTING_ALL:"EXISTING_ALL",EXISTING_ONLY_ANNOTATION:"EXISTING_ANNOTATION",EXISTING_ONLY_CLOUD:"EXISTING_CLOUD"};t["c"]={methods:{hasCloudConfigComment(e){var t,a,s;const r=e?i.a.parseDocument(e):i.a.parseDocument({}),l=(null===r||void 0===r||null===(t=r.contents)||void 0===t?void 0:t.items)||[];let n=!1;return("cloud-config"===(null===r||void 0===r?void 0:r.comment)||null!==r&&void 0!==r&&null!==(a=r.comment)&&void 0!==a&&a.includes("cloud-config\n"))&&(n=!0),("cloud-config"===(null===r||void 0===r?void 0:r.commentBefore)||null!==r&&void 0!==r&&null!==(s=r.commentBefore)&&void 0!==s&&s.includes("cloud-config\n"))&&(n=!0),l.map(e=>{var t;const a=e.key;("cloud-config"===(null===a||void 0===a?void 0:a.commentBefore)||null!==a&&void 0!==a&&null!==(t=a.commentBefore)&&void 0!==t&&t.includes("cloud-config\n"))&&(n=!0)}),n},getSSHValue(e){var t;const a=this.$store.getters[c["b"]+"/all"](c["a"].SSH)||[];return(null===(t=a.find(t=>t.id===e))||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.publicKey)||void 0},getOsType(e){var t;return null===(t=e.metadata)||void 0===t||null===(t=t.labels)||void 0===t?void 0:t[p["a"].OS]},getMatchQGA(e){const t=Object(d["e"])(m);let a=!1;return v["b"].forEach(t=>{t.match&&(a=t.match.find(t=>t===e))}),t.runcmd[0][3]=a?h[e]:h["default"],t},getSimilarRuncmd(e){const t=Object(d["e"])(m);return t.runcmd[0][3]="openSUSE"===e?h["default"]:h["suse"],t.runcmd[0]},hasInstallAgent(e,t,a){var s,i;let r={};const n=this.getMatchQGA(t);try{r=l.a.load(e)||{}}catch(o){return new Error("Function(hasInstallAgent) error"),a}return(null===(s=r)||void 0===s||null===(s=s.packages)||void 0===s?void 0:s.includes("qemu-guest-agent"))&&!(null===(i=r)||void 0===i||null===(i=i.runcmd)||void 0===i||!i.find(e=>Array.isArray(e)&&e.join("-")===n.runcmd[0].join("-")))},isInstallUSBTablet(e){var t;const a=null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.devices)||void 0===t?void 0:t.inputs;return!!Array.isArray(a)&&!!a.find(e=>o()(e,f[0]))},isEfiEnabled(e){var t,a;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.features)||void 0===t||!t.smm||null===e||void 0===e||null===(a=e.template)||void 0===a||null===(a=a.spec)||void 0===a||null===(a=a.domain)||void 0===a||null===(a=a.firmware)||void 0===a||null===(a=a.bootloader)||void 0===a||!a.efi)},isSecureBoot(e){var t;return!(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.domain)||void 0===t||null===(t=t.firmware)||void 0===t||null===(t=t.bootloader)||void 0===t||null===(t=t.efi)||void 0===t||!t.secureBoot)},getCloudInitNoCloud(e){var t,a,s;const i=this.getSecret(e);let r=null===i||void 0===i||null===(t=i.decodedData)||void 0===t?void 0:t.userdata,l=null===i||void 0===i||null===(a=i.decodedData)||void 0===a?void 0:a.networkdata;const n=(null===e||void 0===e||null===(s=e.template)||void 0===s||null===(s=s.spec)||void 0===s||null===(s=s.volumes)||void 0===s||null===(s=s.find(e=>"cloudinitdisk"===e.name))||void 0===s?void 0:s.cloudInitNoCloud)||{};return null!==n&&void 0!==n&&n.userData&&(r=n.userData,this.saveUserDataAsClearText=!0),null!==n&&void 0!==n&&n.networkData&&(l=n.networkData,this.saveNetworkDataAsClearText=!0),{userData:r,networkData:l}},getSecret(e){var t,a,s;const i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t||null===(t=t.volumes)||void 0===t||null===(t=t.find(e=>"cloudinitdisk"===e.name))||void 0===t?void 0:t.cloudInitNoCloud)||{},r=this.$store.getters[c["b"]+"/all"](u["C"])||[],l=(null===i||void 0===i||null===(a=i.secretRef)||void 0===a?void 0:a.name)||(null===i||void 0===i||null===(s=i.networkDataSecretRef)||void 0===s?void 0:s.name),n=r.find(e=>e.metadata.name===l);return n},getAccessCredentials(e){var t,a;const s=this.$store.getters[c["b"]+"/all"](u["C"])||[],i=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.accessCredentials)||[],r=JSON.parse((null===(a=e.template.metadata)||void 0===a||null===(a=a.annotations)||void 0===a?void 0:a[p["a"].DYNAMIC_SSHKEYS_NAMES])||"[]");return i.map(e=>{var t;const a=e.userPassword?"userPassword":"sshPublicKey",i=null===(t=e[a])||void 0===t||null===(t=t.source)||void 0===t||null===(t=t.secret)||void 0===t?void 0:t.secretName,l=s.find(e=>e.metadata.name===i),n={source:a,username:"",newPassword:"",users:[],sshkeys:[],secretName:i,secretRef:l};if(l)if("userPassword"===a){const e=Object.keys(null===l||void 0===l?void 0:l.data)[0],t=l.decodedData[e];n.username=e,n.newPassword=t}else{const t=e[a].propagationMethod.qemuGuestAgent.users,s=null===r||void 0===r?void 0:r[i];n.users=t,n.sshkeys=s}else n.secretRef=void 0;return n})},getVolumeClaimTemplates(e){let t=[];try{t=JSON.parse(e.metadata.annotations[p["a"].VOLUME_CLAIM_TEMPLATE])}catch(a){new Error("Function: getVolumeClaimTemplates, "+a)}return t},getRootImageId(e){var t;const a=this.getVolumeClaimTemplates(e);return(null===(t=a[0])||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[p["a"].IMAGE_ID])||""},getSSHFromAnnotation(e){var t;const a=(null===e||void 0===e||null===(t=e.template)||void 0===t||null===(t=t.metadata)||void 0===t||null===(t=t.annotations)||void 0===t?void 0:t[p["a"].SSH_NAMES])||"[]";return JSON.parse(a)},convertToJson(e=""){let t={};try{t=l.a.load(e)}catch(a){new Error("Function(convertToJson) error")}return t},getSSHFromUserData(e){var t;return(null===(t=this.convertToJson(e))||void 0===t?void 0:t.ssh_authorized_keys)||[]},compareSSHValue(e="",t=""){const a=/(\r\n\t|\n|\r\t)|(\s*)/gm;return e.replace(a,"")===t.replace(a,"")},mergeAllSSHs(e){const t=this.getSSHFromAnnotation(e),{userScript:a}=this.getCloudInitNoCloud(e);if(!(null!==t&&void 0!==t&&t.length)<0&&!a)return[];let s=[];const i=this.$store.getters[c["b"]+"/all"](c["a"].SSH)||[];s=(t||[]).map(e=>{const t=i.find(t=>t.id===e);return t?{id:t.id,data:t,type:b.EXISTING_ALL}:{id:e,data:e,type:b.EXISTING_ONLY_ANNOTATION}});const r=this.getSSHFromUserData(a);return r.map(e=>{const t=i.find(t=>{var a;return this.compareSSHValue(e,null===(a=t.spec)||void 0===a?void 0:a.publicKey)});t&&!s.find(e=>e.id===t.id)?s.push({id:t.id,data:t,type:b.EXISTING_ALL}):t||s.push({id:"Unknown",data:e,type:b.EXISTING_ONLY_CLOUD})}),s}}}},"4be8":function(e,t,a){var s=a("7578");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("04e79bfe",s,!0,{sourceMap:!1,shadowMode:!1})},"4c19":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".graph-options[data-v-b7bcaa58],.graph-options .range-refresh[data-v-b7bcaa58]{display:flex;flex-direction:row;justify-content:flex-end}.graph-options[data-v-b7bcaa58]{justify-content:space-between;align-items:center}.graph-options .labeled-select[data-v-b7bcaa58]{width:100px;margin-left:10px}",""]),e.exports=t},"52e1":function(e,t,a){var s=a("6400");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("7f1ec834",s,!0,{sourceMap:!1,shadowMode:!1})},"535f":function(e,t,a){"use strict";a("100f")},"53ac":function(e,t,a){var s=a("1046");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("51e93ddf",s,!0,{sourceMap:!1,shadowMode:!1})},"58cd":function(e,t,a){var s=a("4c19");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("f81ce53e",s,!0,{sourceMap:!1,shadowMode:!1})},5993:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hec-container"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.dockerImage"),value:e.value.container,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.virtualMachine.volume.dockerImage"),mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.container,callback:function(t){e.$set(e.value,"container",t)},expression:"value.container"}})],1)],1),t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hec-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),options:e.InterfaceOption,mode:e.mode},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],r=a("8e93"),l=a("466b"),n=a("5361"),o=a("7c47"),d={name:"HarvesterEditContainer",components:{LabeledInput:r["a"],LabeledSelect:l["a"],InputOrDisplay:n["a"]},props:{mode:{type:String,default:"create"},value:{type:Object,required:!0}},data(){return{VOLUME_TYPE:o["e"],InterfaceOption:o["b"]}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())}},methods:{update(){this.$emit("update")}}},u=d,c=a("d802"),p=Object(c["a"])(u,s,i,!1,null,null,null);t["default"]=p.exports},"5c0d":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[e.isView?e._e():t("h2",[e._v(" "+e._s(e.t("harvester.virtualMachine.cloudConfig.title"))+" ")]),t("div",{staticClass:"mb-20"},[t("DataTemplate",{ref:"userTemplate",attrs:{type:"user","view-code":e.viewCode,mode:e.mode,"config-id":e.configUserId,options:e.optionUser},on:{show:e.show,update:e.update,updateTemplateId:e.updateTemplateId},model:{value:e.userScript,callback:function(t){e.userScript=t},expression:"userScript"}})],1),t("div",{staticClass:"mb-20"},[t("DataTemplate",{ref:"networkTemplate",attrs:{type:"network","view-code":e.viewCode,mode:e.mode,"config-id":e.configNetworkId,options:e.optionNetwork},on:{show:e.show,update:e.update},model:{value:e.networkScript,callback:function(t){e.networkScript=t},expression:"networkScript"}})],1),t("ModalWithCard",{ref:"createCloudTemplate",attrs:{name:"createCloudTemplate",width:"40%",errors:e.errors},on:{finish:e.save,close:e.cancel},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.cloudConfig.createTemplateTitle",{name:e.createTypeLable}))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("LabeledInput",{staticClass:"mb-20",attrs:{label:e.t("harvester.virtualMachine.input.name"),required:""},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),(()=>{}).apply(null,arguments))}},model:{value:e.cloudTemplateName,callback:function(t){e.cloudTemplateName=t},expression:"cloudTemplateName"}}),t("div",{staticClass:"yaml"},[t("div",{staticClass:"resource-yaml"},[t("YamlEditor",{ref:"createTemplate",staticClass:"yaml-editor",attrs:{"editor-mode":e.editorMode},model:{value:e.cloudTemplate,callback:function(t){e.cloudTemplate=t},expression:"cloudTemplate"}})],1)])]},proxy:!0}])})],1)},i=[],r=a("9ce4"),l=a("8e93"),n=a("870a"),o=a("977e"),d=a("907c"),u=a("873f"),c=a("da25"),p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"mb-20"},[t("h3",[e._v(e._s(e.t(`harvester.virtualMachine.cloudConfig.${e.type}.title`)))]),t("p",{staticClass:"text-muted mb-20"},[t("t",{attrs:{k:`harvester.virtualMachine.cloudConfig.${e.type}.tip`,raw:!0}})],1),e.isView?e._e():t("LabeledSelect",{staticClass:"mb-20",attrs:{options:e.options,disabled:e.viewCode,"label-key":`harvester.virtualMachine.cloudConfig.${e.type}.label`},model:{value:e.id,callback:function(t){e.id=t},expression:"id"}}),t("div",{staticClass:"resource-yaml"},[t("YamlEditor",{ref:"yaml",staticClass:"yaml-editor",attrs:{"editor-mode":e.editorMode},model:{value:e.yamlScript,callback:function(t){e.yamlScript=t},expression:"yamlScript"}})],1)],1)},v=[],m=a("466b"),h=a("90cd");const f="_NEW",b="_NONE";var g={components:{YamlEditor:n["b"],LabeledSelect:m["a"]},props:{mode:{type:String,default:"create"},value:{type:String,default:""},type:{type:String,default:""},options:{type:Array,default:()=>[]},configId:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{id:"",yamlScript:this.value}},computed:{...Object(r["a"])({t:"i18n/t"}),editorMode(){return this.isView||this.viewCode?n["a"].VIEW_CODE:n["a"].EDIT_CODE},isView(){return this.mode===c["w"]}},watch:{value(e){this.yamlScript=e},configId(e){this.id=this.configId},id(e,t){var a;const s=(null===(a=this.$store.getters[h["b"]+"/byId"](d["c"],e))||void 0===a||null===(a=a.data)||void 0===a?void 0:a.cloudInit)||"";if(this.$emit("updateTemplateId",this.type,e),e){if(e===f)return this.$emit("show",this.type),void(this.id=t);this.yamlScript=e===b?"":s,this.$refs["yaml"].updateValue(s)}},yamlScript(e){this.$emit("update",e,this.type)}},methods:{refresh(){this.$refs.yaml.refresh()},updateValue(){this.$refs["yaml"].updateValue(this.value)}}},y=g,w=(a("ba30"),a("d802")),S=Object(w["a"])(y,p,v,!1,null,"7d491695",null),C=S.exports;const _="_NEW",k="_NONE";var O={components:{DataTemplate:C,YamlEditor:n["b"],LabeledInput:l["a"],ModalWithCard:o["a"]},props:{mode:{type:String,default:"create"},namespace:{type:String,default:""},userScript:{type:String,default:""},networkScript:{type:String,default:""},viewCode:{type:Boolean,default:!1}},data(){return{errors:[],templateType:"",cloudTemplate:"",cloudTemplateName:"",configUserId:"",configNetworkId:"",optionUser:[],optionNetwork:[]}},async fetch(){const e=await this.$store.dispatch(h["b"]+"/findAll",{type:d["c"]}),t=[],a=[];for(const r of e){var s,i;"user"===(null===(s=r.metadata)||void 0===s||null===(s=s.labels)||void 0===s?void 0:s[u["a"].CLOUD_INIT])&&t.push({label:null===r||void 0===r?void 0:r.id,value:null===r||void 0===r?void 0:r.id}),"network"===(null===(i=r.metadata)||void 0===i||null===(i=i.labels)||void 0===i?void 0:i[u["a"].CLOUD_INIT])&&a.push({label:null===r||void 0===r?void 0:r.id,value:null===r||void 0===r?void 0:r.id})}t.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:_}),t.unshift({label:this.t("harvester.virtualMachine.cloudConfig.cloudInit.placeholder"),value:k}),a.unshift({label:this.t("harvester.virtualMachine.cloudConfig.createNew"),value:_}),a.unshift({label:this.t("harvester.virtualMachine.cloudConfig.cloudInit.placeholder"),value:k}),this.optionUser=t,this.optionNetwork=a},computed:{...Object(r["a"])({t:"i18n/t"}),createTypeLable(){const e=`harvester.virtualMachine.cloudConfig.${this.templateType}.label`;return this.t(e)},editorMode(){return this.isView?n["a"].VIEW_CODE:n["a"].EDIT_CODE},isView(){return this.mode===c["w"]}},methods:{updateValue(){this.$refs["userTemplate"].updateValue(),this.$refs["networkTemplate"].updateValue()},update(e,t){"user"===t&&this.$emit("updateUserData",e),"network"===t&&this.$emit("updateNetworkData",e)},updateTemplateId(e,t){this.$emit("updateDataTemplateId",e,t)},show(e){this.templateType=e,this.$modal.show("createCloudTemplate")},async save(e){if(this.errors=[],!this.cloudTemplateName)return this.errors.push(this.t("validation.required",{key:this.t("harvester.virtualMachine.input.name")},!0)),void e(!1);if(!this.cloudTemplate){const t="user"===this.templateType?"harvester.cloudTemplate.userData":"harvester.cloudTemplate.networkData";return this.errors.push(this.t("validation.required",{key:this.t(t)},!0)),void e(!1)}const t=await this.$store.dispatch(h["b"]+"/create",{type:d["c"],metadata:{labels:{[u["a"].CLOUD_INIT]:this.templateType},name:this.cloudTemplateName,namespace:this.namespace},data:{cloudInit:this.cloudTemplate}});try{const a=await t.save();a.id&&("user"===this.templateType?this.configUserId=a.id:this.configNetworkId=a.id,this.$fetch()),e(!0),this.cancel()}catch(a){this.errors=[a.message],e(!1)}},cancel(){this.cloudTemplate="",this.cloudTemplateName="",this.$set(this,"errors",[]),this.$modal.hide("createCloudTemplate")},refresh(){this.$refs["userTemplate"].refresh(),this.$refs["networkTemplate"].refresh()}}},I=O,E=(a("535f"),Object(w["a"])(I,s,i,!1,null,"6a2ca441",null));t["a"]=E.exports},"5cb0":function(e,t,a){"use strict";a("fc40")},"62d1":function(e,t,a){var s=a("0f89");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("6e8b7c3a",s,!0,{sourceMap:!1,shadowMode:!1})},6306:function(e,t,a){var s=a("9f15");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("559fbd48",s,!0,{sourceMap:!1,shadowMode:!1})},6400:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".box[data-v-0f12bd93]{position:relative}.title[data-v-0f12bd93]{display:flex}.title .state[data-v-0f12bd93]{font-size:16px}.remove[data-v-0f12bd93]{position:absolute;top:10px;right:10px;padding:0}.bootOrder[data-v-0f12bd93]{display:flex;align-items:center}.buttons[data-v-0f12bd93]{width:100%;display:flex;justify-content:flex-end}.volume-status[data-v-0f12bd93]:first-letter{text-transform:uppercase}.resource-external[data-v-0f12bd93]{display:flex;justify-content:center;align-items:center}",""]),e.exports=t},6834:function(e,t,a){"use strict";a.d(t,"a",(function(){return E})),a.d(t,"b",(function(){return M}));var s=a("e3b5"),i=a.n(s),r=a("7838"),l=a.n(r),n=a("9e74"),o=a.n(n),d=a("330a"),u=a.n(d),c=a("94a3"),p=a.n(c),v=a("1d19"),m=a("e24b"),h=a("a8b9"),f=a("2cb5"),b=a("0f81"),g=a("d37d"),y=a("7c47"),w=a("da25"),S=a("907c"),C=a("90cd");const _={BACKUP_TARGET:"backup-target",CONTAINERD_REGISTRY:"containerd-registry",LOG_LEVEL:"log-level",SERVER_VERSION:"server-version",UI_INDEX:"ui-index",UI_PLUGIN_INDEX:"ui-plugin-index",UPGRADE_CHECKER_ENABLED:"upgrade-checker-enabled",UPGRADE_CHECKER_URL:"upgrade-checker-url",VLAN:"vlan",UI_SOURCE:"ui-source",HTTP_PROXY:"http-proxy",ADDITIONAL_CA:"additional-ca",OVERCOMMIT_CONFIG:"overcommit-config",CLUSTER_REGISTRATION_URL:"cluster-registration-url",DEFAULT_STORAGE_CLASS:"default-storage-class",VIP:"vip-pools",SUPPORT_BUNDLE_TIMEOUT:"support-bundle-timeout",SUPPORT_BUNDLE_IMAGE:"support-bundle-image",STORAGE_NETWORK:"storage-network",VM_FORCE_RESET_POLICY:"vm-force-reset-policy",SSL_CERTIFICATES:"ssl-certificates",SSL_PARAMETERS:"ssl-parameters",SUPPORT_BUNDLE_NAMESPACES:"support-bundle-namespaces",AUTO_DISK_PROVISION_PATHS:"auto-disk-provision-paths",RELEASE_DOWNLOAD_URL:"release-download-url",CCM_CSI_VERSION:"harvester-csi-ccm-versions"};_.BACKUP_TARGET,_.LOG_LEVEL,_.VLAN,_.SERVER_VERSION,_.UPGRADE_CHECKER_ENABLED,_.UPGRADE_CHECKER_URL,_.HTTP_PROXY,_.ADDITIONAL_CA,_.OVERCOMMIT_CONFIG,_.SUPPORT_BUNDLE_TIMEOUT,_.SUPPORT_BUNDLE_IMAGE,_.STORAGE_NETWORK,_.VM_FORCE_RESET_POLICY,_.SSL_CERTIFICATES,_.VIP,_.SSL_PARAMETERS,_.SUPPORT_BUNDLE_NAMESPACES,_.AUTO_DISK_PROVISION_PATHS,_.RELEASE_DOWNLOAD_URL,_.UI_PLUGIN_INDEX,_.CONTAINERD_REGISTRY,_.UI_SOURCE,_.UI_INDEX,_.CLUSTER_REGISTRATION_URL;var k=a("4ac6"),O=a("873f"),I=a("4b06");const E="management Network",M=[{label:"Windows",value:"windows"},{label:"Linux",value:"linux"},{label:"SUSE Linux Enterprise",value:"SLEs"},{label:"Debian",value:"debian"},{label:"Fedora",value:"fedora"},{label:"Gentoo",value:"gentoo"},{label:"Oracle",value:"oracle"},{label:"Red Hat",value:"redhat"},{label:"openSUSE",value:"openSUSE"},{label:"Ubuntu",value:"ubuntu"},{label:"Other Linux",match:["centos"],value:"otherLinux"}],x="cd-rom",T="disk";t["c"]={mixins:[I["c"]],props:{value:{type:Object,required:!0},resource:{type:String,default:""}},async fetch(){var e;const t={pvs:this.$store.dispatch(C["b"]+"/findAll",{type:S["x"]}),pvcs:this.$store.dispatch(C["b"]+"/findAll",{type:S["y"]}),storageClasses:this.$store.dispatch(C["b"]+"/findAll",{type:S["F"]}),sshs:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].SSH}),settings:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].SETTING}),images:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].IMAGE}),versions:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].VM_VERSION}),templates:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].VM_TEMPLATE}),networkAttachment:this.$store.dispatch(C["b"]+"/findAll",{type:S["r"]}),vmis:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].VMI}),vmims:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].VMIM}),vms:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].VM}),secrets:this.$store.dispatch(C["b"]+"/findAll",{type:S["C"]}),addons:this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].ADD_ONS})};this.$store.getters[C["b"]+"/schemaFor"](S["t"])&&(t.nodes=this.$store.dispatch(C["b"]+"/findAll",{type:S["t"]})),this.$store.getters[C["b"]+"/schemaFor"](C["a"].CLUSTER_NETWORK)&&(t.clusterNetworks=this.$store.dispatch(C["b"]+"/findAll",{type:C["a"].CLUSTER_NETWORK}));const a=await Object(h["a"])(t),s=this.$store.getters[C["b"]+"/schemaFor"](C["a"].PCI_DEVICE);this.enabledPCI=!0===(null===(e=a.addons.find(e=>"pcidevices-controller"===e.name))||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.enabled)&&s},data(){const e=this.realMode===w["l"];return{OS:M,isClone:e,spec:null,osType:"linux",sshKey:[],runStrategy:"RerunOnFailure",installAgent:!0,hasCreateVolumes:[],installUSBTablet:!0,networkScript:"",userScript:"",imageId:"",diskRows:[],networkRows:[],machineType:"",secretName:"",secretRef:null,showAdvanced:!1,deleteAgent:!0,memory:null,cpu:"",reservedMemory:null,accessCredentials:[],efiEnabled:!0,secureBoot:!0,userDataTemplateId:"",saveUserDataAsClearText:!1,saveNetworkDataAsClearText:!1,enabledPCI:!1,immutableMode:this.realMode===w["n"]?w["n"]:w["w"]}},computed:{inStore(){return C["b"]},images(){return this.$store.getters[this.inStore+"/all"](C["a"].IMAGE)},versions(){return this.$store.getters[this.inStore+"/all"](C["a"].VM_VERSION)},templates(){return this.$store.getters[this.inStore+"/all"](C["a"].VM_TEMPLATE)},pvcs(){return this.$store.getters[this.inStore+"/all"](S["y"])},secrets(){return this.$store.getters[this.inStore+"/all"](S["C"])},nodesIdOptions(){const e=this.$store.getters[this.inStore+"/all"](S["t"]);return e.filter(e=>!e.isUnSchedulable).map(e=>({label:e.nameDisplay,value:e.id}))},defaultStorageClass(){var e;const t=this.$store.getters[this.inStore+"/all"](S["F"]).find(e=>e.isDefault);return(null===t||void 0===t||null===(e=t.metadata)||void 0===e?void 0:e.name)||"longhorn"},storageClassSetting(){try{var e;const t=null===(e=this.$store.getters[this.inStore+"/all"](C["a"].SETTING).find(e=>e.id===_.DEFAULT_STORAGE_CLASS))||void 0===e?void 0:e.value;return JSON.parse(t)}catch(t){return{}}},customVolumeMode(){return this.storageClassSetting.volumeMode||"Block"},customAccessMode(){return this.storageClassSetting.accessModes||"ReadWriteMany"},isWindows(){return"windows"===this.osType},needNewSecret(){return this.resource===C["a"].VM_VERSION||this.isCreate}},async created(){await this.$store.dispatch(this.inStore+"/findAll",{type:S["C"]}),this.getInitConfig({value:this.value,init:this.isCreate})},methods:{getInitConfig(e){var t,a,s,i,r;const{value:l,existUserData:n,fromTemplate:o=!1,init:d=!1}=e,u=this.resource===C["a"].VM?l:this.resource===C["a"].BACKUP?null===(t=this.value.status)||void 0===t?void 0:t.source:l.spec.vm,c=null===u||void 0===u?void 0:u.spec;if(!c)return;const p=c.template.spec.domain.resources;null!==p&&void 0!==p&&p.limits&&(null===p||void 0===p||!p.limits||null!==p&&void 0!==p&&null!==(a=p.limits)&&void 0!==a&&a.memory||null===(null===p||void 0===p||null===(s=p.limits)||void 0===s?void 0:s.memory))||(c.template.spec.domain.resources={...c.template.spec.domain.resources,limits:{...c.template.spec.domain.resources.limits,memory:c.template.spec.domain.resources.requests.memory}});const v=c.runStrategy||"RerunOnFailure",m=l.machineType,h=null===(i=c.template.spec.domain)||void 0===i||null===(i=i.cpu)||void 0===i?void 0:i.cores,f=c.template.spec.domain.resources.limits.memory,g=null===(r=u.metadata)||void 0===r||null===(r=r.annotations)||void 0===r?void 0:r[O["a"].VM_RESERVED_MEMORY],y=this.getSSHFromAnnotation(c)||[],w=this.getRootImageId(u)||"",S=this.getDiskRows(u),_=this.getNetworkRows(u,{fromTemplate:o,init:d}),k=this.getHasCreatedVolumes(c)||[];let{userData:I,networkData:E}=this.getCloudInitNoCloud(c);if(this.resource===C["a"].BACKUP){var M;const e=null===(M=this.value.status)||void 0===M?void 0:M.secretBackups;if(e){var x,T;const t=(null===(x=e[0])||void 0===x||null===(x=x.data)||void 0===x?void 0:x.networkdata)||"",a=(null===(T=e[0])||void 0===T||null===(T=T.data)||void 0===T?void 0:T.userdata)||"";I=Object(b["a"])(a),E=Object(b["a"])(t)}}const N=this.getOsType(u)||"linux";I=!this.isCreate||n||this.isClone?I:this.getInitUserData({osType:N});const A=this.isInstallUSBTablet(c),$=this.hasInstallAgent(I,N,!0),D=this.isEfiEnabled(c),V=this.isSecureBoot(c),R=this.getSecret(c),U=this.getAccessCredentials(c);Object.prototype.hasOwnProperty.call(c,"running")&&(delete c.running,c.runStrategy="RerunOnFailure"),this.$set(this,"spec",c),this.$set(this,"runStrategy",v),this.$set(this,"secretRef",R),this.$set(this,"accessCredentials",U),this.$set(this,"userScript",I),this.$set(this,"networkScript",E),this.$set(this,"sshKey",y),this.$set(this,"osType",N),this.$set(this,"installAgent",$),this.$set(this,"cpu",h),this.$set(this,"memory",f),this.$set(this,"reservedMemory",g),this.$set(this,"machineType",m),this.$set(this,"installUSBTablet",A),this.$set(this,"efiEnabled",D),this.$set(this,"secureBoot",V),this.$set(this,"hasCreateVolumes",k),this.$set(this,"networkRows",_),this.$set(this,"imageId",w),this.$set(this,"diskRows",S),this.refreshYamlEditor()},getDiskRows(e){const t=e.metadata.namespace,a=e.spec.template.spec.volumes||[],s=e.spec.template.spec.domain.devices.disks||[],i=this.getVolumeClaimTemplates(e);let r=[];return 0===s.length?r.push({id:Object(f["p"])(5),source:y["d"].IMAGE,name:"disk-0",accessMode:"ReadWriteMany",bus:"virtio",volumeName:"",size:"10Gi",type:T,storageClassName:"",image:this.imageId,volumeMode:"Block"}):r=s.map((e,s)=>{var r,l,n,o;const d=a.find(t=>t.name===e.name);let u="",c="",p="",v="",m="",h="",b="",w="",_="",k=!1,I=null;const E=null!==e&&void 0!==e&&e.cdrom?x:null!==e&&void 0!==e&&e.disk?T:"";if(null!==d&&void 0!==d&&d.containerDisk&&(p=y["d"].CONTAINER,m=d.containerDisk.image),d.persistentVolumeClaim&&null!==(r=d.persistentVolumeClaim)&&void 0!==r&&r.claimName){h=d.persistentVolumeClaim.claimName;const e=i.find(e=>e.metadata.name===h);if(v=h,e){var M,N,A,$;if(void 0!==(null===(M=e.metadata)||void 0===M||null===(M=M.annotations)||void 0===M?void 0:M[O["a"].IMAGE_ID]))c=null===($=e.metadata)||void 0===$||null===($=$.annotations)||void 0===$?void 0:$[O["a"].IMAGE_ID],p=y["d"].IMAGE;else p=y["d"].NEW;const t=(null===e||void 0===e?void 0:e.spec)||{};w=null===t||void 0===t?void 0:t.volumeMode,b=null===t||void 0===t||null===(N=t.accessModes)||void 0===N?void 0:N[0],u=(null===t||void 0===t||null===(A=t.resources)||void 0===A||null===(A=A.requests)||void 0===A?void 0:A.storage)||"10Gi",_=null===t||void 0===t?void 0:t.storageClassName,I=null===t||void 0===t?void 0:t.dataSource}else{var D,V,R,U,L;const e=this.$store.getters[C["b"]+"/all"](S["y"]),a=e.find(e=>{var a;return e.id===`${t}/${null===d||void 0===d||null===(a=d.persistentVolumeClaim)||void 0===a?void 0:a.claimName}`});p=y["d"].ATTACH_VOLUME,b=(null===a||void 0===a||null===(D=a.spec)||void 0===D||null===(D=D.accessModes)||void 0===D?void 0:D[0])||"ReadWriteMany",u=(null===a||void 0===a||null===(V=a.spec)||void 0===V||null===(V=V.resources)||void 0===V||null===(V=V.requests)||void 0===V?void 0:V.storage)||"10Gi",_=null===a||void 0===a||null===(R=a.spec)||void 0===R?void 0:R.storageClassName,w=(null===a||void 0===a||null===(U=a.spec)||void 0===U?void 0:U.volumeMode)||"Block",h=(null===a||void 0===a||null===(L=a.metadata)||void 0===L?void 0:L.name)||""}k=d.persistentVolumeClaim.hotpluggable||!1}const j=(null===e||void 0===e||null===(l=e.disk)||void 0===l?void 0:l.bus)||(null===e||void 0===e||null===(n=e.cdrom)||void 0===n?void 0:n.bus),P=null!==e&&void 0!==e&&e.bootOrder?null===e||void 0===e?void 0:e.bootOrder:s,B=Object(g["d"])(u),q=Object(g["c"])(B,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3}),K=null===(o=this.pvcs.find(e=>e.id===`${this.value.metadata.namespace}/${h}`))||void 0===o||null===(o=o.relatedPV)||void 0===o||null===(o=o.metadata)||void 0===o||null===(o=o.annotations)||void 0===o?void 0:o[O["a"].VOLUME_ERROR];return{id:Object(f["p"])(5),bootOrder:P,source:p,name:e.name,realName:v,bus:j,volumeName:h,container:m,accessMode:b,size:q+"Gi",volumeMode:w||this.customVolumeMode,image:c,type:E,storageClassName:_,hotpluggable:k,volumeStatus:K,dataSource:I}}),r=Object(v["a"])(r,"bootOrder"),r.filter(e=>"cloudinitdisk"!==e.name)},getNetworkRows(e,t){const{fromTemplate:a=!1,init:s=!1}=t,i=e.spec.template.spec.networks||[],r=e.spec.template.spec.domain.devices.interfaces||[],l=r.map((e,t)=>{var r;const l=i.find(t=>e.name===t.name),n=e.masquerade||e.bridge?"masquerade":"macvtap",o=!!l.pod;return{...e,index:t,type:n,isPod:o,newCreateId:!(!a&&!s)&&Object(f["p"])(10),model:e.model,networkName:o?E:null===l||void 0===l||null===(r=l.multus)||void 0===r?void 0:r.networkName}});return l},parseVM(){this.userData=this.getUserData({osType:this.osType,installAgent:this.installAgent}),this.parseOther(),this.parseAccessCredentials(),this.parseNetworkRows(this.networkRows),this.parseDiskRows(this.diskRows)},parseOther(){this.spec.template.spec.domain.machine?this.$set(this.spec.template.spec.domain.machine,"type",this.machineType):this.$set(this.spec.template.spec.domain,"machine",{type:this.machineType}),this.spec.template.spec.domain.cpu.cores=this.cpu,this.spec.template.spec.domain.resources.limits.cpu=this.cpu?this.cpu.toString():this.cpu,this.spec.template.spec.domain.resources.limits.memory=this.memory;const e=this.resource===C["a"].VM?this.value:this.value.spec.vm;this.reservedMemory?e.metadata.annotations[O["a"].VM_RESERVED_MEMORY]=this.reservedMemory:delete e.metadata.annotations[O["a"].VM_RESERVED_MEMORY]},parseDiskRows(e){var t,a,s,i,r,l,n;const o=[],d=[],u=[],c=[];if(e.forEach((e,t)=>{var a;const s=(null===(a=this.value.metadata)||void 0===a?void 0:a.name)||"";let i="";i=e.source===y["d"].ATTACH_VOLUME?e.volumeName:this.isClone||!this.hasCreateVolumes.includes(e.realName)?`${s}-${e.name}-${Object(f["p"])(5).toLowerCase()}`:e.realName;const r=this.parseDisk(e,t),l=this.parseVolume(e,i),n=this.parseVolumeClaimTemplate(e,i);o.push(r),d.push(l),u.push(i),e.source!==y["d"].CONTAINER&&c.push(n)}),this.secretName&&!this.needNewSecret||(this.secretName=this.generateSecretName(this.secretNamePrefix)),!o.find(e=>"cloudinitdisk"===e.name)&&(this.userData||this.networkData)&&!this.isWindows){o.push({name:"cloudinitdisk",disk:{bus:"virtio"}});const e=this.getUserData({osType:this.osType,installAgent:this.installAgent}),t={name:"cloudinitdisk",cloudInitNoCloud:{}};this.saveUserDataAsClearText?t.cloudInitNoCloud.userData=e:t.cloudInitNoCloud.secretRef={name:this.secretName},this.saveNetworkDataAsClearText?t.cloudInitNoCloud.networkData=this.networkScript:t.cloudInitNoCloud.networkDataSecretRef={name:this.secretName},d.push(t)}let p={...this.spec,runStrategy:this.runStrategy,template:{...this.spec.template,metadata:{...null===(t=this.spec)||void 0===t||null===(t=t.template)||void 0===t?void 0:t.metadata,annotations:{...null===(a=this.spec)||void 0===a||null===(a=a.template)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.annotations,[O["a"].SSH_NAMES]:JSON.stringify(this.sshKey)},labels:{...null===(s=this.spec)||void 0===s||null===(s=s.template)||void 0===s||null===(s=s.metadata)||void 0===s?void 0:s.labels,[O["a"].VM_NAME]:null===(i=this.value)||void 0===i||null===(i=i.metadata)||void 0===i?void 0:i.name}},spec:{...null===(r=this.spec.template)||void 0===r?void 0:r.spec,domain:{...null===(l=this.spec.template)||void 0===l||null===(l=l.spec)||void 0===l?void 0:l.domain,devices:{...null===(n=this.spec.template)||void 0===n||null===(n=n.spec)||void 0===n||null===(n=n.domain)||void 0===n?void 0:n.devices,disks:o}},volumes:d}}};0===d.length&&delete p.template.spec.volumes,this.resource===C["a"].VM?(this.isSingle||(p=this.multiVMScheduler(p)),this.$set(this.value.metadata,"annotations",{...this.value.metadata.annotations,[O["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(c),[O["a"].NETWORK_IPS]:JSON.stringify(this.value.networkIps)}),this.$set(this.value.metadata,"labels",{...this.value.metadata.labels,[O["a"].CREATOR]:"harvester",[O["a"].OS]:this.osType}),this.$set(this.value,"spec",p),this.$set(this,"spec",p)):this.resource===C["a"].VM_VERSION&&(this.$set(this.value.spec.vm,"spec",p),this.$set(this.value.spec.vm.metadata,"annotations",{...this.value.spec.vm.metadata.annotations,[O["a"].VOLUME_CLAIM_TEMPLATE]:JSON.stringify(c)}),this.$set(this.value.spec.vm.metadata,"labels",{[O["a"].OS]:this.osType}),this.$set(this,"spec",p))},multiVMScheduler(e){var t,a;e.template.metadata.labels[O["a"].VM_NAME_PREFIX]=this.namePrefix;const s={weight:1,podAffinityTerm:{topologyKey:k["g"],labelSelector:{matchLabels:{[O["a"].VM_NAME_PREFIX]:this.namePrefix}}}};return{...e,template:{...e.template,spec:{...e.template.spec,affinity:{...e.template.spec.affinity,podAntiAffinity:{...null===(t=e.template.spec)||void 0===t||null===(t=t.affinity)||void 0===t?void 0:t.podAntiAffinity,preferredDuringSchedulingIgnoredDuringExecution:[...(null===(a=e.template.spec)||void 0===a||null===(a=a.affinity)||void 0===a||null===(a=a.podAntiAffinity)||void 0===a?void 0:a.preferredDuringSchedulingIgnoredDuringExecution)||[],s]}}}}}},parseNetworkRows(e){const t=[],a=[];e.forEach(e=>{const s=this.parseNetwork(e),i=this.parseInterface(e);t.push(s),a.push(i)});const s={...this.spec.template.spec,domain:{...this.spec.template.spec.domain,devices:{...this.spec.template.spec.domain.devices,interfaces:a}},networks:t};this.$set(this.spec.template,"spec",s)},parseAccessCredentials(){var e;const t=[],a={},s=JSON.parse((null===(e=this.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[O["a"].DYNAMIC_SSHKEYS_USERS])||"[]");for(const i of this.accessCredentials)this.needNewSecret&&(i.secretName=this.generateSecretName(this.secretNamePrefix)),i.source===y["a"].RESET_PWD&&(s.push(i.username),t.push({userPassword:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{}}}})),i.source===y["a"].INJECT_SSH&&(s.push(...i.users),a[i.secretName]=i.sshkeys,t.push({sshPublicKey:{source:{secret:{secretName:i.secretName}},propagationMethod:{qemuGuestAgent:{users:i.users}}}}));0===t.length&&this.spec.template.spec.accessCredentials?delete this.spec.template.spec.accessCredentials:this.spec.template.spec.accessCredentials=t,0!==s.length&&(this.spec.template.metadata.annotations[O["a"].DYNAMIC_SSHKEYS_USERS]=JSON.stringify(Array.from(new Set(s))),this.spec.template.metadata.annotations[O["a"].DYNAMIC_SSHKEYS_NAMES]=JSON.stringify(a))},getInitUserData(e){const t=this.getMatchQGA(e.osType),a=l.a.dump(t);return"#cloud-config\n"+a},getUserData(e){try{let t=this.userScript?i.a.parseDocument(this.userScript):i.a.parseDocument({});const a=this.mergeSSHAuthorizedKeys(this.userScript);a.length>0?t.setIn(["ssh_authorized_keys"],a):i.a.isCollection(t.getIn("ssh_authorized_keys"))&&t.deleteIn(["ssh_authorized_keys"]),t=e.installAgent?this.mergeQGA({userDataDoc:t,...e}):this.deleteQGA({userDataDoc:t,...e});const s=t.toString();if("{}\n"===s)return;return s}catch(t){return console.error("Error: Unable to parse yaml document",t),this.userScript}},updateSSHKey(e){this.$set(this,"sshKey",e)},updateCpuMemory(e,t){this.$set(this,"cpu",e),this.$set(this,"memory",t)},parseDisk(e,t){const a={name:e.name};return e.type===T?a.disk={bus:e.bus}:e.type===x&&(a.cdrom={bus:e.bus}),a.bootOrder=t+1,a},parseVolume(e,t){const a={name:e.name};return e.source===y["d"].CONTAINER?a.containerDisk={image:e.container}:e.source!==y["d"].IMAGE&&e.source!==y["d"].NEW&&e.source!==y["d"].ATTACH_VOLUME||(a.persistentVolumeClaim={claimName:t},e.hotpluggable&&(a.persistentVolumeClaim.hotpluggable=!0)),a},parseVolumeClaimTemplate(e,t){!String(e.size).includes("Gi")&&e.size&&(e.size=e.size+"Gi");const a={metadata:{name:t},spec:{accessModes:[e.accessMode],resources:{requests:{storage:e.size}},volumeMode:e.volumeMode}};switch(e.dataSource&&(a.spec.dataSource=e.dataSource),e.source){case y["d"].ATTACH_VOLUME:a.spec.storageClassName=e.storageClassName;break;case y["d"].NEW:a.spec.storageClassName=e.storageClassName;break;case y["d"].IMAGE:{const t=this.images.find(t=>e.image===t.id);t?(a.spec.storageClassName="longhorn-"+t.metadata.name,a.metadata.annotations={[O["a"].IMAGE_ID]:t.id}):a.metadata.annotations={[O["a"].IMAGE_ID]:""};break}}return a},getSSHListValue(e){return e.map(e=>this.getSSHValue(e)).filter(e=>void 0!==e)},parseInterface(e){const t={},a=e.type;return t[a]={},e.macAddress&&(t.macAddress=e.macAddress),t.model=e.model,t.name=e.name,t},parseNetwork(e){const t={name:e.name};return e.isPod?t.pod={}:t.multus={networkName:e.networkName},t},updateUserData(e){this.userScript=e},updateNetworkData(e){this.networkScript=e},mergeSSHAuthorizedKeys(e){try{var t;const a=(null===(t=i.a.parseDocument(e).get("ssh_authorized_keys"))||void 0===t?void 0:t.toJSON())||[],s=this.getSSHListValue(this.sshKey);return a.length?[...new Set([...s,...a])]:s}catch(a){return[]}},deleteYamlDocProp(e,t){try{var a,s;const i=null===(a=e.getIn([]))||void 0===a?void 0:a.items[0],r=null===i||void 0===i?void 0:i.key,l=!(null===r||void 0===r||null===(s=r.commentBefore)||void 0===s||!s.includes("cloud-config")),n=r.source===t[t.length-1];r&&l&&n||e.deleteIn(t)}catch(i){}},mergeQGA(e){const{osType:t,userDataDoc:a}=e,s=this.getMatchQGA(t),r=a.toString(),l=i.a.parse(r);let n=(null===l||void 0===l?void 0:l.packages)||[],o=(null===l||void 0===l?void 0:l.runcmd)||[];if(a.setIn(["package_update"],!0),Array.isArray(n)?n.includes("qemu-guest-agent")||n.push("qemu-guest-agent"):n=I["a"].packages,Array.isArray(o)){let e=-1;const a=o.find(e=>Array.isArray(e)&&e.join("-")===s.runcmd[0].join("-")),i=o.find((a,s)=>!(!Array.isArray(a)||a.join("-")!==this.getSimilarRuncmd(t).join("-"))&&(e=s,!0));i?o[e]=s.runcmd[0]:a||o.push(s.runcmd[0])}else o=s.runcmd;return n.length>0?a.setIn(["packages"],n):(a.setIn(["packages"],[]),this.deleteYamlDocProp(a,["packages"]),this.deleteYamlDocProp(a,["package_update"])),o.length>0?a.setIn(["runcmd"],o):this.deleteYamlDocProp(a,["runcmd"]),a},deleteQGA(e){var t;const{osType:a,userDataDoc:s,deletePackage:r=!1}=e,l=(null===(t=this.$store.getters[C["b"]+"/byId"](S["c"],this.userDataTemplateId))||void 0===t||null===(t=t.data)||void 0===t?void 0:t.cloudInit)||"",n=s.toString(),o=i.a.parse(n),d=(null===o||void 0===o?void 0:o.packages)||[],u=(null===o||void 0===o?void 0:o.runcmd)||[];if(Array.isArray(d)&&r){const e=this.convertToJson(l);for(let t=0;t<d.length;t++)"qemu-guest-agent"===d[t]&&(Array.isArray(null===e||void 0===e?void 0:e.packages)&&e.packages.includes("qemu-guest-agent")||d.splice(t,1))}if(Array.isArray(u)){const e=this.getMatchQGA(a);for(let t=0;t<u.length;t++)Array.isArray(u[t])&&u[t].join("-")===e.runcmd[0].join("-")&&u.splice(t,1)}return d.length>0?s.setIn(["packages"],d):(s.setIn(["packages"],[]),this.deleteYamlDocProp(s,["packages"]),this.deleteYamlDocProp(s,["package_update"])),u.length>0?s.setIn(["runcmd"],u):this.deleteYamlDocProp(s,["runcmd"]),s},generateSecretName(e){return e?`${e}-${Object(f["p"])(5).toLowerCase()}`:void 0},getOwnerReferencesFromVM(e){var t;const a=e.metadata.name,s=e.kind,i=this.resource===C["a"].VM?"kubevirt.io/v1":"harvesterhci.io/v1beta1",r=null===e||void 0===e||null===(t=e.metadata)||void 0===t?void 0:t.uid;return[{name:a,kind:s,uid:r,apiVersion:i}]},async saveSecret(e){if(null===e||void 0===e||!e.spec||!this.secretName||this.isWindows)return!0;let t=this.getSecret(e.spec);!t&&this.isEdit&&this.secretRef&&(t=this.secretRef),t&&!this.needNewSecret||(t=await this.$store.dispatch(C["b"]+"/create",{metadata:{name:this.secretName,namespace:this.value.metadata.namespace,labels:{[O["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:S["C"]}));try{t&&(this.saveUserDataAsClearText&&this.saveNetworkDataAsClearText||(t.setData("userdata",this.userData||""),t.setData("networkdata",this.networkScript||""),await t.save()))}catch(a){return Promise.reject(a)}},async saveAccessCredentials(e){if(null===e||void 0===e||!e.spec)return!0;const t=[];for(const s of this.accessCredentials){let a=s.secretRef;if(a&&!this.needNewSecret||(a=await this.$store.dispatch(C["b"]+"/create",{metadata:{name:s.secretName,namespace:e.metadata.namespace,labels:{[O["a"].CLOUD_INIT]:"harvester"},ownerReferences:this.getOwnerReferencesFromVM(e)},type:S["C"]})),s.source===y["a"].RESET_PWD&&a.setData(s.username,s.newPassword),s.source===y["a"].INJECT_SSH)for(const e of s.sshkeys){const t=(this.$store.getters["cluster/all"](C["a"].SSH)||[]).find(t=>t.id===e);a.setData(`${t.metadata.namespace}-${t.metadata.name}`,t.spec.publicKey)}t.push(a)}try{for(const e of t)await e.save()}catch(a){return Promise.reject(a)}},getAccessCredentialsValidation(){const e=[];for(let t=0;t<this.accessCredentials.length;t++){const a=this.accessCredentials[t],s=a.source;if(s===y["a"].RESET_PWD){if(!a.username){const t=this.t("harvester.virtualMachine.input.username"),a=this.t("validation.required",{key:t});e.push(a)}if(!a.newPassword){const t=this.t("harvester.virtualMachine.input.password"),a=this.t("validation.required",{key:t});e.push(a)}if(a.newPassword&&a.newPassword.length<6){const t=this.t("harvester.virtualMachine.input.password"),a=this.t("validation.number.min",{key:t,val:"6"});e.push(a)}}else{if(!a.users||0===a.users.length){const t=this.t("harvester.virtualMachine.input.username"),a=this.t("validation.required",{key:t});e.push(a)}if(!a.sshkeys||0===a.sshkeys.length){const t=this.t("harvester.virtualMachine.input.sshKeyValue"),a=this.t("validation.required",{key:t});e.push(a)}}if(e.length>0)break}return e},getHasCreatedVolumes(e){const t=[];return e.template.spec.volumes&&e.template.spec.volumes.forEach(e=>{var a;null!==e&&void 0!==e&&null!==(a=e.persistentVolumeClaim)&&void 0!==a&&a.claimName&&t.push(e.persistentVolumeClaim.claimName)}),t},handlerUSBTablet(e){var t;const a=this.isInstallUSBTablet(this.spec),s=(null===(t=this.spec.template.spec.domain.devices)||void 0===t?void 0:t.inputs)||[];if(e&&!a)s.length>0?s.push(I["b"][0]):Object.assign(this.spec.template.spec.domain.devices,{inputs:[I["b"][0]]});else if(!e){const e=s.findIndex(e=>o()(e,I["b"][0]));a&&1===s.length?this.$delete(this.spec.template.spec.domain.devices,"inputs"):a&&(s.splice(e,1),this.$set(this.spec.template.spec.domain.devices,"inputs",s))}},setBootMethod(e={efi:!1,secureBoot:!1}){e.efi&&e.secureBoot?(Object(m["j"])(this.spec.template.spec.domain,"features.smm.enabled",!0),Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!0)):e.efi&&!e.secureBoot?(Object(m["j"])(this.spec.template.spec.domain,"features.smm.enabled",!1),Object(m["j"])(this.spec.template.spec.domain,"firmware.bootloader.efi.secureBoot",!1)):(this.$delete(this.spec.template.spec.domain,"firmware"),this.$delete(this.spec.template.spec.domain.features,"smm"))},deleteSSHFromUserData(e=[]){const t=this.getSSHFromUserData(this.userScript);e.map(e=>{const a=t.findIndex(t=>t===this.getSSHValue(e));a>=0&&t.splice(a,1)});const a=this.convertToJson(this.userScript);a.ssh_authorized_keys=t,0===t.length&&delete a.ssh_authorized_keys,u()(a)?this.$set(this,"userScript",void 0):this.$set(this,"userScript",l.a.dump(a)),this.refreshYamlEditor()},refreshYamlEditor(){this.$nextTick(()=>{var e;null===(e=this.$refs.yamlEditor)||void 0===e||e.updateValue()})},toggleAdvanced(){this.showAdvanced=!this.showAdvanced},updateAgent(e){e||(this.deletePackage=!0)},updateDataTemplateId(e,t){if("user"===e){const e=this.installAgent;this.userDataTemplateId=t,this.$nextTick(()=>{e&&(this.installAgent=e)})}},updateReserved(e={}){const{memory:t}=e;this.$set(this,"reservedMemory",t)}},watch:{diskRows:{handler(e,t){if(Array.isArray(e)){var a,s;const i=null===(a=e[0])||void 0===a?void 0:a.image,r=this.images.find(e=>i===e.id),l=null===r||void 0===r?void 0:r.imageOSType,n=null===(s=t[0])||void 0===s?void 0:s.image;this.isCreate&&n===i&&i&&(this.osType=l)}}},secretRef:{handler(e){e&&this.resource!==C["a"].BACKUP&&(this.secretName=null===e||void 0===e?void 0:e.metadata.name)},immediate:!0,deep:!0},isWindows(e){e&&(this.$set(this,"sshKey",[]),this.$set(this,"userScript",void 0),this.$set(this,"installAgent",!1))},installUSBTablet(e){this.handlerUSBTablet(e)},efiEnabled(e){this.setBootMethod({efi:e,secureBoot:this.secureBoot})},secureBoot(e){this.setBootMethod({efi:this.efiEnabled,secureBoot:e})},installAgent:{handler(e){if(this.deleteAgent){let t=this.getUserData({installAgent:e,osType:this.osType,deletePackage:this.deletePackage});if(e){const e=this.hasCloudConfigComment(t);e||(t="#cloud-config\n"+t)}this.$set(this,"userScript",t),this.refreshYamlEditor()}this.deleteAgent=!0,this.deletePackage=!1}},osType(e){const t=this.getUserData({installAgent:this.installAgent,osType:e});this.$set(this,"userScript",t),this.refreshYamlEditor()},userScript(e,t){const a=this.hasInstallAgent(e,this.osType,this.installAgent);a!==this.installAgent&&(this.deleteAgent=!1,this.installAgent=a)},sshKey(e,t){const a=p()(t,e);a.length&&this.isEdit&&this.deleteSSHFromUserData(a)}}}},"69d1":function(e,t,a){"use strict";a("1234")},"6c40":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".label[data-v-357627fa]{display:flex;flex-direction:column}.label .value[data-v-357627fa]{font-size:14px;line-height:18px}",""]),e.exports=t},"73e2":function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overview-web-console"},[t("ButtonDropdown",{attrs:{disabled:e.isOff,"no-drop":e.isOff,"button-label":"Console","dropdown-options":e.options,size:"sm"},on:{"click-action":e.handleDropdown}})],1)},i=[],r=a("4975"),l=a("4aac"),n=a("9ce4"),o=a("44f6"),d={name:"VMConsoleBar",components:{ButtonDropdown:r["a"]},props:{resource:{type:Object,required:!0,default:()=>({})}},computed:{...Object(n["a"])({t:"i18n/t"}),isOff(){return this.resource.stateDisplay===o["OFF"]},options(){return[{label:this.t("harvester.virtualMachine.console.novnc"),value:"vnc"},{label:this.t("harvester.virtualMachine.console.serial"),value:"serial"}]}},methods:{handleDropdown(e){this.show(e.value)},show(e){var t,a;let s=null===(t=this.resource.metadata)||void 0===t||null===(t=t.ownerReferences)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.uid;void 0===s&&(s=this.resource.metadata.uid);const i=window.location.host,r=window.location.pathname.replace(this.$route.path,""),n=null===(a=this.$route)||void 0===a?void 0:a.params,o=`https://${i}${r}/${l["PRODUCT_NAME"]}/c/${n.cluster}/console/${s}/${e}`;window.open(o,"_blank","toolbars=0,width=900,height=700,left=0,top=0,noreferrer")},isEmpty(e){return void 0!==e&&0===Object.keys(e).length}}},u=d,c=(a("fcd5"),a("d802")),p=Object(c["a"])(u,s,i,!1,null,null,null);t["a"]=p.exports},"74f9":function(e,t,a){var s=a("d62a");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("3bcd258b",s,!0,{sourceMap:!1,shadowMode:!1})},7578:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,"[data-v-7d491695] .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-7d491695] .resource-yaml .yaml-editor{flex:1;min-height:200px}[data-v-7d491695] .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:200px}",""]),e.exports=t},"77b1":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".infoBox[data-v-b57c60be]{position:relative}.remove-vol[data-v-b57c60be]{position:absolute;top:10px;right:16px;padding:0;max-height:28px;min-height:28px}",""]),e.exports=t},"77f0":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".action[data-v-4ed320b6]{display:flex;flex-direction:row-reverse}",""]),e.exports=t},8058:function(e,t,a){"use strict";a("b773")},8133:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"label"},[t("div",{staticClass:"text-label"},[e._t("name",(function(){return[e._v(" "+e._s(e.name)+" ")]}))],2),t("div",{staticClass:"value"},[e._t("value",(function(){return[e._v(" "+e._s(e.value)+" ")]}))],2)])},i=[],r={props:{name:{type:String,required:!0},value:{type:[Number,String,void 0],default:""}}},l=r,n=(a("2e9d"),a("d802")),o=Object(n["a"])(l,s,i,!1,null,"357627fa",null);t["a"]=o.exports},8287:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[t("Banner",{staticClass:"mb-20",attrs:{color:"info",label:e.t("harvester.virtualMachine.accessCredentials.tips")}}),e._l(e.rows,(function(a,s){return t("div",{key:a.id},[t("InfoBox",{staticClass:"volume-source"},[e.isEdit?t("button",{staticClass:"role-link btn btn-sm remove-vol",attrs:{type:"button"},on:{click:function(t){return e.remove(a)}}},[t("i",{staticClass:"icon icon-x"})]):e._e(),t("h3",[t("span",[e._v(" "+e._s(e.headerFor(a.source))+" ")])]),t("div",[t(e.componentFor(a.source),{tag:"component",attrs:{rows:e.rows,resource:e.resource,"user-options":e.userOptions,mode:e.mode,idx:s},on:{update:e.update,"update:newUser":e.updateNewUser},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1)])],1)})),e.isEdit&&e.isQemuInstalled?t("div",{staticClass:"mt-20"},[t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addCredentials(e.ACCESS_CREDENTIALS.RESET_PWD)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.resetPwd.label"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addCredentials(e.ACCESS_CREDENTIALS.INJECT_SSH)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.accessCredentials.injectSSH.label"))+" ")])]):e._e()],2)},i=[],r=a("9ce4"),l=a("6418"),n=a("13a9"),o=a("2cb5"),d=a("bddd"),u=a("7c47"),c=a("da25"),p=a("873f");const v="_NEW";var m={components:{Banner:l["a"],InfoBox:n["a"]},props:{value:{type:Array,default:()=>[]},resource:{type:Object,default:()=>({})},mode:{type:String,default:"create"},disableCreate:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isQemuInstalled:{type:Boolean,default:!1}},data(){return{ACCESS_CREDENTIALS:u["a"],toRemove:[],toSave:[],rows:[],newUserOptions:[]}},computed:{...Object(r["a"])({t:"i18n/t"}),isEdit(){return this.mode===c["p"]},historyUsersOptions(){var e;const t=JSON.parse((null===(e=this.resource)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.metadata)||void 0===e||null===(e=e.annotations)||void 0===e?void 0:e[p["a"].DYNAMIC_SSHKEYS_USERS])||"[]");return t.unshift({label:this.t("harvester.virtualMachine.accessCredentials.injectSSH.addUser"),value:v}),t},userOptions(){return Array.from(new Set([...this.historyUsersOptions,...this.newUserOptions]))}},watch:{value:{handler(e){this.rows=[...e]},deep:!0,immediate:!0}},methods:{addCredentials(e){const t={source:e,users:[],sshkeys:[],username:"",newPassword:"",secretName:this.generateSecretName(this.resource.metadata.name)};this.rows.push(t),this.update()},remove(e){Object(d["i"])(this.rows,e),this.update()},update(){this.$emit("input",this.rows)},updateNewUser(e){this.newUserOptions.push(e)},generateSecretName(e){return e?`${e}-${Object(o["p"])(5).toLowerCase()}`:void 0},componentFor(e){switch(e){case u["a"].RESET_PWD:return a("e299").default;case u["a"].INJECT_SSH:return a("db40").default}},headerFor(e){return{userPassword:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.resetPwd.label"),sshPublicKey:this.$store.getters["i18n/t"]("harvester.virtualMachine.accessCredentials.injectSSH.label")}[e]}}},h=m,f=(a("9f93"),a("d802")),b=Object(f["a"])(h,s,i,!1,null,"6386f148",null);t["a"]=b.exports},"8e57":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".error[data-v-295e0aeb]{color:var(--error)}",""]),e.exports=t},9216:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[e.isView?e._e():t("Banner",{attrs:{color:"info","label-key":"harvester.virtualMachine.volume.dragTip"}}),t("draggable",{attrs:{disabled:e.isView},on:{end:e.update},model:{value:e.rows,callback:function(t){e.rows=t},expression:"rows"}},[t("transition-group",e._l(e.rows,(function(a,s){return t("div",{key:a.id},[t("InfoBox",{staticClass:"box"},[e.isView?e._e():t("button",{staticClass:"role-link btn btn-sm remove",attrs:{type:"button"},on:{click:function(t){return e.removeVolume(a)}}},[t("i",{staticClass:"icon icon-x"})]),a.hotpluggable&&e.isView?t("button",{staticClass:"role-link btn remove",attrs:{type:"button"},on:{click:function(t){return e.unplugVolume(a)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.unplug.detachVolume"))+" ")]):e._e(),t("h3",[a.to&&e.isVirtualType?t("span",{staticClass:"title"},[t("n-link",{attrs:{to:a.to}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.edit"))+" "+e._s(e.headerFor(a.source))+" ")]),a.pvc?t("BadgeStateFormatter",{staticClass:"ml-10 state",attrs:{arbitrary:!0,row:a.pvc,value:a.pvc.state}}):e._e(),e.dev&&a.pvc.resourceExternalLink?t("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.t(a.pvc.resourceExternalLink.tipsKey||"generic.resourceExternalLinkTips"),expression:"t(volume.pvc.resourceExternalLink.tipsKey || 'generic.resourceExternalLinkTips')"}],staticClass:"ml-5 resource-external",attrs:{rel:"nofollow noopener noreferrer",target:"_blank",href:a.pvc.resourceExternalLink.url}},[t("i",{staticClass:"icon icon-external-link"})]):e._e()],1):t("span",[e._v(" "+e._s(e.headerFor(a.source))+" ")])]),t("div",[t(e.componentFor(a.source),{tag:"component",attrs:{rows:e.rows,namespace:e.namespace,"is-create":e.isCreate,"is-edit":e.isEdit,"is-view":e.isView,"is-virtual-type":e.isVirtualType,mode:e.mode,idx:s,"validate-required":e.validateRequired},on:{update:e.update},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1),t("div",{staticClass:"bootOrder"},[e.isView?e._e():t("div",{staticClass:"mr-15"},[t("button",{staticClass:"btn btn-sm role-primary",attrs:{disabled:0===s},on:{click:function(t){return t.preventDefault(),e.changeSort(s,!1)}}},[t("i",{staticClass:"icon icon-lg icon-chevron-up"})]),t("button",{staticClass:"btn btn-sm role-primary",attrs:{disabled:s===e.rows.length-1},on:{click:function(t){return t.preventDefault(),e.changeSort(s,!0)}}},[t("i",{staticClass:"icon icon-lg icon-chevron-down"})])]),t("div",{staticClass:"text-muted"},[e._v(" bootOrder: "+e._s(s+1)+" ")])]),a.volumeStatus&&!e.isCreate?t("Banner",{staticClass:"mt-15 volume-status",attrs:{color:"warning",label:a.volumeStatus}}):e._e()],1)],1)})),0)],1),e.showVolumeTip?t("Banner",{attrs:{color:"warning",label:e.t("harvester.virtualMachine.volume.volumeTip")}}):e._e(),e.isView?e._e():t("div",[t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button",disabled:0===e.rows.length},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.NEW)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addVolume"))+" ")]),e.existingVolumeDisabled?e._e():t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.ATTACH_VOLUME)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addExistingVolume"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mr-15 mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.IMAGE)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addVmImage"))+" ")]),t("button",{staticClass:"btn btn-sm bg-primary mb-10",attrs:{type:"button"},on:{click:function(t){return e.addVolume(e.SOURCE_TYPE.CONTAINER)}}},[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.addContainer"))+" ")])]),t("ModalWithCard",{ref:"deleteTip",attrs:{name:"deleteTip",width:400},scopedSlots:e._u([{key:"title",fn:function(){return[e._v(" "+e._s(e.t("harvester.virtualMachine.volume.unmount.title"))+" ")]},proxy:!0},{key:"content",fn:function(){return[t("span",[e._v(e._s(e.t("harvester.virtualMachine.volume.unmount.message")))])]},proxy:!0},{key:"footer",fn:function(){return[t("div",{staticClass:"buttons"},[t("button",{staticClass:"btn role-secondary mr-20",on:{click:function(t){return t.preventDefault(),e.cancel.apply(null,arguments)}}},[e._v(" "+e._s(e.t("generic.no"))+" ")]),t("button",{staticClass:"btn bg-primary mr-20",on:{click:function(t){return t.preventDefault(),e.deleteVolume.apply(null,arguments)}}},[e._v(" "+e._s(e.t("generic.yes"))+" ")])])]},proxy:!0}])})],1)},i=[],r=a("6e12"),l=a.n(r),n=a("13a9"),o=a("6418"),d=a("7b24"),u=a("4978"),c=a("8e93"),p=a("466b"),v=a("977e"),m=a("907c"),h=a("90cd"),f=a("e24b"),b=a("bddd"),g=a("2cb5"),y=a("7c47"),w=a("da25"),S=a("4aac"),C=a("5000"),_={components:{Banner:o["a"],BadgeStateFormatter:d["a"],draggable:l.a,InfoBox:n["a"],LabeledInput:c["a"],UnitInput:u["a"],LabeledSelect:p["a"],ModalWithCard:v["a"]},props:{vm:{type:Object,default:()=>({})},mode:{type:String,default:w["n"]},value:{type:Array,default:()=>[]},namespace:{type:String,default:null},existingVolumeDisabled:{type:Boolean,default:!1},validateRequired:{type:Boolean,default:!1},customVolumeMode:{type:String,default:"Block"},customAccessMode:{type:String,default:"ReadWriteMany"},resourceType:{type:String,default:""}},async fetch(){await this.$store.dispatch(h["b"]+"/findAll",{type:m["y"]})},data(){return{SOURCE_TYPE:y["d"],rows:Object(f["e"])(this.value),nameIdx:1,vol:null}},computed:{dev(){try{return this.$store.getters["prefs/get"](C["l"])}catch{return this.$store.getters["prefs/get"](C["c"])}},isVirtualType(){return this.resourceType===h["a"].VM},isView(){return this.mode===w["w"]},isEdit(){return this.mode===w["p"]},isCreate(){return this.mode===w["n"]},showVolumeTip(){var e;const t=this.getImageDisplayName(null===(e=this.rows[0])||void 0===e?void 0:e.image);return!(1!==this.rows.length||"cd-rom"!==this.rows[0].type||!/.iso$/i.test(t))},pvcs(){return this.$store.getters[h["b"]+"/all"](m["y"])||[]}},watch:{value:{handler(e){const t=e.map(e=>(this.isCreate||e.source===y["d"].CONTAINER||e.newCreateId||(e.to={name:S["PRODUCT_NAME"]+"-c-cluster-resource-namespace-id",params:{resource:h["a"].VOLUME,namespace:this.namespace,id:e.realName},query:{mode:w["p"]}},e.pvc=this.pvcs.find(t=>t.metadata.name===e.realName)),e));this.$set(this,"rows",t)},deep:!0,immediate:!0}},methods:{addVolume(e){const t=this.generateName(),a={id:Object(g["p"])(5),name:t,source:e,size:"10Gi",type:"disk",accessMode:this.customAccessMode,volumeMode:this.customVolumeMode,volumeName:"",bus:"virtio",newCreateId:Object(g["p"])(10)};if(e===y["d"].NEW){var s;const e=this.$store.getters[h["b"]+"/all"](m["F"]).find(e=>e.isDefault);a.storageClassName=(null===e||void 0===e||null===(s=e.metadata)||void 0===s?void 0:s.name)||"longhorn"}this.rows.push(a),this.update()},generateName(){let e="",t=!0;while(t)e="disk-"+this.nameIdx,t=this.rows.find(t=>t.name===e),this.nameIdx++;return e},removeVolume(e){this.vol=e,!e.newCreateId&&this.isEdit&&this.isVirtualType?this.$refs.deleteTip.open():(Object(b["i"])(this.rows,e),this.update())},unplugVolume(e){this.vm.unplugVolume(e.name)},componentFor(e){switch(e){case y["d"].NEW:return a("0e4c").default;case y["d"].IMAGE:return a("df1c").default;case y["d"].ATTACH_VOLUME:return a("4890").default;case y["d"].CONTAINER:return a("5993").default}},headerFor(e){return{[y["d"].NEW]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.volume"),[y["d"].IMAGE]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.vmImage"),[y["d"].ATTACH_VOLUME]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.existingVolume"),[y["d"].CONTAINER]:this.$store.getters["i18n/t"]("harvester.virtualMachine.volume.title.container")}[e]},update(){this.$emit("input",this.rows)},deleteVolume(){Object(b["i"])(this.rows,this.vol),this.update(),this.cancel()},cancel(){this.$refs.deleteTip.hide()},changeSort(e,t){this.rows.splice(t?e:e-1,1,...this.rows.splice(t?e+1:e,1,this.rows[t?e:e-1])),this.update()},getImageDisplayName(e){var t;return null===(t=this.$store.getters[h["b"]+"/all"](h["a"].IMAGE).find(t=>t.id===e))||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.displayName}}},k=_,O=(a("a42b"),a("d802")),I=Object(O["a"])(k,s,i,!1,null,"0f12bd93",null);t["a"]=I.exports},9237:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("Tabbed",e._b({staticClass:"mt-15",attrs:{"side-tabs":!0},on:{changed:e.onTabChanged}},"Tabbed",e.$attrs,!1),[t("Tab",{staticClass:"bordered-table",attrs:{name:"basics",label:e.t("harvester.virtualMachine.detail.tabs.basics"),weight:7}},[t("OverviewBasics",{attrs:{resource:e.vmi,mode:"view"},model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),t("Tab",{staticClass:"bordered-table",attrs:{name:"disks",label:e.t("harvester.tab.volume"),weight:6}},[t("Volume",{attrs:{mode:"view",namespace:e.value.metadata.namespace,vm:e.value,"resource-type":e.value.type},model:{value:e.diskRows,callback:function(t){e.diskRows=t},expression:"diskRows"}})],1),t("Tab",{staticClass:"bordered-table",attrs:{name:"networks",label:e.t("harvester.virtualMachine.detail.tabs.networks"),weight:5}},[t("Network",{attrs:{mode:"view"},model:{value:e.networkRows,callback:function(t){e.networkRows=t},expression:"networkRows"}})],1),t("Tab",{staticClass:"bordered-table",attrs:{name:"keypairs",label:e.t("harvester.virtualMachine.detail.tabs.keypairs"),weight:3}},[t("OverviewKeypairs",{model:{value:e.value,callback:function(t){e.value=t},expression:"value"}})],1),e.showVmMetrics?t("Tab",{attrs:{name:"vm-metrics",label:e.t("harvester.virtualMachine.detail.tabs.metrics"),weight:2.5},scopedSlots:e._u([{key:"default",fn:function(a){return[a.active?t("DashboardMetrics",{attrs:{"detail-url":e.VM_METRICS_DETAIL_URL,"graph-height":"550px","has-summary-and-detail":!1,vars:e.graphVars}}):e._e()]}}],null,!1,4264103987)}):e._e(),t("Tab",{staticClass:"bordered-table",attrs:{label:e.t("harvester.tab.accessCredentials"),name:"accessCredentials",weight:2.2}},[t("AccessCredentials",{attrs:{mode:"view",value:e.accessCredentials,resource:e.value}})],1),t("Tab",{staticClass:"bordered-table",attrs:{name:"cloudConfig",label:e.t("harvester.virtualMachine.detail.tabs.cloudConfig"),weight:2}},[t("CloudConfig",{ref:"yamlEditor",attrs:{mode:"view","user-script":e.userScript,"network-script":e.networkScript}})],1),t("Tab",{attrs:{name:"event",label:e.t("harvester.virtualMachine.detail.tabs.events"),weight:1}},[t("Events",{attrs:{resource:e.vmi,events:e.events}})],1)],1)],1)},i=[],r=a("9ce4"),l=a("0cb2"),n=a("38de"),o=a("907c"),d=a("90cd"),u=a("305c"),c=a("6834"),p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"dashboard-metrics",class:!e.hasSummaryAndDetail&&"external-link-pull-left"},[t("div",{staticClass:"graph-options mb-10"},[t("DashboardOptions",{attrs:{"has-summary-and-detail":e.hasSummaryAndDetail},model:{value:e.graphOptions,callback:function(t){e.graphOptions=t},expression:"graphOptions"}})],1),t("div",{staticClass:"info"},[e._t("default")],2),t("div",{staticClass:"graphs",style:{height:e.graphHeight}},["detail"===e.graphOptions.type?t("GrafanaDashboard",{key:"'detail'",staticClass:"col span-12 detail",attrs:{"background-color":e.graphBackgroundColor,theme:e.theme,"refresh-rate":e.graphOptions.refreshRate,range:e.graphOptions.range,url:e.detailUrl,vars:e.vars,"modify-prefix":e.modifyPrefix}}):t("GrafanaDashboard",{key:"'summary'",staticClass:"col span-12 summary",attrs:{"background-color":e.graphBackgroundColor,theme:e.theme,"refresh-rate":e.graphOptions.refreshRate,range:e.graphOptions.range,url:e.summaryUrl,vars:e.vars,"modify-prefix":e.modifyPrefix}})],1)])},v=[],m=function(){var e=this,t=e._self._c;return t("div",{staticClass:"graph-options"},[e.hasSummaryAndDetail?t("div",[t("ButtonGroup",{attrs:{options:e.detailSummaryOptions},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1):t("div",[t("div")]),t("div",{staticClass:"range-refresh"},[t("LabeledSelect",{attrs:{options:e.rangeOptions,label:e.t("graphOptions.range")},model:{value:e.value.range,callback:function(t){e.$set(e.value,"range",t)},expression:"value.range"}}),t("LabeledSelect",{attrs:{options:e.refreshOptions,label:e.t("graphOptions.refresh")},model:{value:e.value.refreshRate,callback:function(t){e.$set(e.value,"refreshRate",t)},expression:"value.refreshRate"}})],1)])},h=[],f=a("cc2d"),b=a("466b"),g={components:{ButtonGroup:f["a"],LabeledSelect:b["a"]},props:{value:{type:Object,required:!0},hasSummaryAndDetail:{type:Boolean,default:!0}},data(){return{range:null,rangeOptions:[{label:this.t("generic.units.time.5m"),value:"5m"},{label:this.t("generic.units.time.1h"),value:"1h"},{label:this.t("generic.units.time.6h"),value:"6h"},{label:this.t("generic.units.time.1d"),value:"1d"},{label:this.t("generic.units.time.7d"),value:"7d"},{label:this.t("generic.units.time.30d"),value:"30d"}],refreshOptions:[{label:this.t("generic.units.time.5s"),value:"5s"},{label:this.t("generic.units.time.10s"),value:"10s"},{label:this.t("generic.units.time.30s"),value:"30s"},{label:this.t("generic.units.time.1m"),value:"1m"},{label:this.t("generic.units.time.5m"),value:"5m"},{label:this.t("generic.units.time.15m"),value:"15m"},{label:this.t("generic.units.time.30m"),value:"30m"},{label:this.t("generic.units.time.1h"),value:"1h"},{label:this.t("generic.units.time.2h"),value:"2h"},{label:this.t("generic.units.time.1d"),value:"1d"}],detailSummaryOptions:[{label:this.t("graphOptions.detail"),value:"detail"},{label:this.t("graphOptions.summary"),value:"summary"}]}}},y=g,w=(a("3823"),a("d802")),S=Object(w["a"])(y,m,h,!1,null,"b7bcaa58",null),C=S.exports,_=function(){var e=this,t=e._self._c;return t("div",{staticClass:"grafana-graph"},[e.error?t("Banner",{staticStyle:{"z-index":"1000"},attrs:{color:"error"}},[t("div",{staticClass:"text-center"},[e._v(" "+e._s(e.t("grafanaDashboard.failedToLoad"))+" "),t("a",{attrs:{href:"#"},on:{click:e.reload}},[e._v(e._s(e.t("grafanaDashboard.reload")))])])]):e._e(),t("iframe",{directives:[{name:"show",rawName:"v-show",value:!e.error,expression:"!error"}],ref:"frame",class:{loading:e.loading,frame:!0},attrs:{src:e.currentUrl,frameborder:"0",scrolling:"no"}}),e.loading?t("div",[t("Loading")],1):e._e(),e.loading||e.error?e._e():t("div",{staticClass:"external-link"},[t("a",{attrs:{href:e.grafanaUrl,target:"_blank",rel:"noopener nofollow"}},[e._v(e._s(e.t("grafanaDashboard.grafana"))+" "),t("i",{staticClass:"icon icon-external-link"})])])],1)},k=[],O=a("15ca"),I=a("6418"),E=a("f390"),M=a("4048");const x=["100.2.0+up40.1.2","102.0.0+up40.1.2"];function T(e,t){return x.includes(e)?"/k8s/clusters/"+t:"local"===t?"":"/k8s/clusters/"+t}function N(e,t,a,s,i=!0){const r=Object(M["b"])(t);let l=i?`${T(e,a)}${r.path}`:r.path;return r.query.viewPanel&&(l=Object(M["a"])(l,"viewPanel",r.query.viewPanel)),l=Object(M["a"])(l,"orgId",r.query.orgId),l=Object(M["a"])(l,"kiosk",null),Object.entries(s).forEach(e=>{l=Object(M["a"])(l,e[0],e[1])}),l}async function A(e,t,a,s,i="cluster",r=null){if(!Object(E["b"])(t.getters))return!1;const l=Object(M["b"])(s);let n=T(e,a)+"/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-grafana:80/proxy/",o="http:rancher-monitoring-grafana:80/proxy/";r&&(n=`${T(e,a)}/api/v1/namespaces/cattle-project-${r}-monitoring/services/http:cattle-project-${r}-monitoring-grafana:80/proxy/`,o=`http:cattle-project-${r}-monitoring-grafana:80/proxy/`);const d=l.path.split(o)[1],u=d.split("/")[1],c=`${n}api/dashboards/uid/${u}`;try{return await t.dispatch(i+"/request",{url:c,redirectUnauthorized:!1}),!0}catch(p){return!1}}async function $(e,t,a,s="cluster",i=null){let r,l="";if(!i&&e.getters[s+"/canList"](o["b"].APP)){var n;try{r=await e.dispatch(s+"/find",{type:o["b"].APP,id:"cattle-monitoring-system/rancher-monitoring"})}catch(u){}l=null===(n=r)||void 0===n?void 0:n.currentVersion}const d=a.map(a=>A(l,e,t,a,s,i));return(await Promise.all(d)).every(e=>e)}var D={components:{Banner:I["a"],Loading:O["a"]},props:{url:{type:String,required:!0},vars:{type:Object,default:()=>({})},range:{type:String,default:null},refreshRate:{type:String,default:null},modifyPrefix:{type:Boolean,default:!0},backgroundColor:{type:String,default:"#1b1c21"},theme:{type:String,default:"dark"}},async fetch(){const e=this.$store.getters["currentProduct"].inStore;if(this.$store.getters[e+"/canList"](o["b"].APP))try{const t=await this.$store.dispatch(e+"/find",{type:o["b"].APP,id:"cattle-monitoring-system/rancher-monitoring"});this.monitoringVersion=null===t||void 0===t?void 0:t.currentVersion}catch(t){}},data(){return{loading:!1,error:!1,interval:null,errorTimer:null,monitoringVersion:""}},computed:{currentUrl(){return this.computeUrl()},grafanaUrl(){return this.currentUrl.replace("&kiosk","")},graphWindow(){var e;return null===(e=this.$refs.frame)||void 0===e?void 0:e.contentWindow},graphHistory(){var e;return null===(e=this.graphWindow)||void 0===e?void 0:e.history},graphDocument(){var e;return null===(e=this.graphWindow)||void 0===e?void 0:e.document}},watch:{currentUrl(e){var t;this.graphHistory&&null!==(t=this.graphWindow)&&void 0!==t&&t.angular&&this.graphWindow.location.replace(e)},error(e){e?this.errorTimer=setInterval(()=>{this.reload()},45e3):(clearInterval(this.errorTimer),this.errorTimer=null)}},mounted(){this.$refs.frame.onload=this.inject,this.poll()},beforeDestroy(){this.interval&&clearInterval(this.interval),this.errorTimer&&clearInterval(this.errorTimer)},methods:{poll(){this.interval&&(clearInterval(this.interval),this.interval=null),this.interval=setInterval(()=>{try{var e;const t=null===(e=this.$refs.frame)||void 0===e?void 0:e.contentWindow,a=t.document.getElementsByClassName("alert-error"),s=t.document.getElementsByClassName("panel-info-corner--error"),i=t.document.getElementsByClassName("panel-in-fullscreen"),r=t.document.getElementsByClassName("panel-container"),l=a.length>0||s.length>0,n=i.length>0||r.length>0,o=t.document.getElementsByTagName("pre"),d=o.length>0?o[0].innerText:"",u=d.includes('"status": "Failure"');if(l)throw new Error("An error was detected in the iframe");this.$set(this,"loading",!n),this.$set(this,"error",u)}catch(t){this.$set(this,"error",!0),this.$set(this,"loading",!1),clearInterval(this.interval),this.interval=null}},100)},computeFromTo(){return{from:"now-"+this.range,to:"now"}},computeUrl(){const e=this.url,t=this.$store.getters["currentCluster"].id,a=this.computeParams();return N(this.monitoringVersion,e,t,a,this.modifyPrefix)},computeParams(){const e={},t=this.computeFromTo();return t.from&&(e.from=t.from),t.to&&(e.to=t.to),this.refreshRate&&(e.refresh=this.refreshRate),Object.keys(this.vars).length>0&&Object.entries(this.vars).forEach(t=>{const a="var-"+t[0];e[a]=t[1]}),e.theme=this.theme,e},reload(e){e&&e.preventDefault(),this.$refs.frame.contentWindow.location.reload(),this.poll()},injectCss(){var e;const t=document.createElement("style");t.innerHTML=`\n        body .grafana-app .dashboard-content {\n          background: ${this.backgroundColor};\n          padding: 0;\n        }\n\n        body .grafana-app .layout {\n          background: ${this.backgroundColor};\n        }\n\n\n        body .grafana-app .dashboard-content .panel-container {\n          background-color: initial;\n          border: none;\n        }\n\n        body .grafana-app .dashboard-content .panel-wrapper {\n          height: 100%;\n        }\n\n        body .grafana-app .panel-menu-container {\n          display: none;\n        }\n\n        body .grafana-app .panel-title {\n          cursor: default;\n        }\n\n        body .grafana-app .panel-title .panel-title-text div {\n          display: none;\n        }\n      `;const a=null===(e=this.$refs.frame)||void 0===e?void 0:e.contentWindow,s=null===a||void 0===a?void 0:a.document;s.head&&s.head.appendChild(t)},inject(){this.injectCss()}}},V=D,R=(a("fbd4"),Object(w["a"])(V,_,k,!1,null,"eeaaabda",null)),U=R.exports,L={components:{DashboardOptions:C,GrafanaDashboard:U},props:{detailUrl:{type:String,required:!0},summaryUrl:{type:String,default:""},vars:{type:Object,default:()=>({})},graphHeight:{type:String,required:!0},hasSummaryAndDetail:{type:Boolean,default:!0},modifyPrefix:{type:Boolean,default:!0}},data(){return{graphOptions:{range:"5m",refreshRate:"30s",type:"detail"}}},computed:{...Object(r["a"])(["prefs/theme"]),graphBackgroundColor(){return"dark"===this.theme?"#2e3035":"#f3f4f9"},theme(){return this["prefs/theme"]}}},j=L,P=(a("b661"),Object(w["a"])(j,p,v,!1,null,"1e72d538",null)),B=P.exports,q=a("a8b9"),K=a("5c0d"),H=a("9216"),G=a("fea5"),F=a("8287"),W=function(){var e=this,t=e._self._c;return t("SortableTable",{attrs:{rows:e.events,headers:e.eventHeaders,"key-field":"id",search:!1,"table-actions":!1,"row-actions":!1,paging:!0,"rows-per-page":10,"default-sort-by":"date"},scopedSlots:e._u([{key:"cell:resource",fn:function({row:a,value:s}){return[t("div",{staticClass:"text-info"},[e._v(" "+e._s(s)+" ")]),a.message?t("div",[e._v(" "+e._s(a.displayMessage)+" ")]):e._e()]}}])})},Y=[],z=a("462f"),J=a("0fb1"),X={name:"VirtualMachineEvents",components:{SortableTable:J["b"]},props:{events:{type:Array,required:!0}},data(){const e={...z["C"],canBeVariable:!0,width:180},t=[e,{name:"resource",label:"Resource",labelKey:"clusterIndexPage.sections.events.resource.label",value:"displayInvolvedObject",sort:["involvedObject.kind","involvedObject.name"],canBeVariable:!0},{align:"right",name:"date",label:"Date",labelKey:"clusterIndexPage.sections.events.date.label",value:"lastTimestamp",sort:"lastTimestamp:desc",formatter:"LiveDate",formatterOpts:{addSuffix:!0},width:125,defaultSort:!0}];return{eventHeaders:t}}},Q=X,Z=Object(w["a"])(Q,W,Y,!1,null,null,null),ee=Z.exports,te=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overview-basics"},[t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.name"),value:e.value.nameDisplay},scopedSlots:e._u([{key:"value",fn:function(){return[t("div",{staticClass:"smart-row"},[t("div",{staticClass:"console"},[e._v(" "+e._s(e.value.nameDisplay)+" "),t("VMConsoleBar",{staticClass:"consoleBut",attrs:{resource:e.value}})],1)])]},proxy:!0}])})],1),t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.fields.image"),value:e.imageName}})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.hostname"),value:e.hostname},scopedSlots:e._u([{key:"value",fn:function(){return[e.isDown?t("div",[e._v(" "+e._s(e.t("harvester.virtualMachine.detail.details.down"))+" ")]):t("div",[e._v(" "+e._s(e.hostname||e.t("harvester.virtualMachine.detail.GuestAgentNotInstalled"))+" ")])]},proxy:!0}])})],1),t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.node"),value:e.node},scopedSlots:e._u([{key:"value",fn:function(){return[e.isDown?t("div",[e._v(" "+e._s(e.t("harvester.virtualMachine.detail.details.down"))+" ")]):t("div",[e._v(" "+e._s(e.node)+" ")])]},proxy:!0}])})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.ipAddress")},scopedSlots:e._u([{key:"value",fn:function(){return[t("HarvesterIpAddress",{attrs:{row:e.value},model:{value:e.value.id,callback:function(t){e.$set(e.value,"id",t)},expression:"value.id"}})]},proxy:!0}])})],1),t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.created"),value:e.creationTimestamp}})],1)]),t("hr",{staticClass:"section-divider"}),t("h2",[e._v(e._s(e.t("harvester.virtualMachine.detail.tabs.configurations")))]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.detail.details.bootOrder"),value:e.disks,mode:e.mode},scopedSlots:e._u([{key:"value",fn:function(){return[t("ul",e._l(e.disks,(function(a){return t("li",{key:a.bootOrder},[e._v(" "+e._s(a.bootOrder)+". "+e._s(a.name)+" ("+e._s(e.getDeviceType(a))+") ")])})),0)]},proxy:!0}])})],1),t("div",{staticClass:"col span-6"},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.detail.details.CDROMs"),value:e.cdroms,mode:e.mode},scopedSlots:e._u([{key:"value",fn:function(){return[t("div",[e.cdroms.length>0?t("ul",e._l(e.cdroms,(function(a){return t("li",{key:a.name},[e._v(" "+e._s(a.name)+" ")])})),0):t("span",[e._v(" "+e._s(e.t("harvester.virtualMachine.detail.notAvailable"))+" ")])])]},proxy:!0}])})],1)]),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.operatingSystem"),value:e.operatingSystem||e.t("harvester.virtualMachine.detail.GuestAgentNotInstalled")}})],1),t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.flavor"),value:e.flavor}})],1),t("div",{staticClass:"row"},[t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.detail.details.kernelRelease"),value:e.kernelRelease||e.t("harvester.virtualMachine.detail.GuestAgentNotInstalled")}})],1),t("div",{staticClass:"col span-6"},[t("LabelValue",{attrs:{name:e.t("harvester.virtualMachine.input.MachineType"),value:e.machineType}})],1)])])},ae=[],se=a("a858"),ie=a("73e2"),re=a("8133"),le=a("5361");const ne="n/a";var oe={name:"Details",components:{VMConsoleBar:ie["a"],HarvesterIpAddress:se["default"],LabelValue:re["a"],InputOrDisplay:le["a"]},mixins:[u["a"]],props:{value:{type:Object,required:!0},resource:{type:Object,required:!0,default:()=>({})},mode:{type:String,required:!0}},computed:{creationTimestamp(){var e;const t=new Date(null===(e=this.value)||void 0===e||null===(e=e.metadata)||void 0===e?void 0:e.creationTimestamp);return t.getMonth?`${t.getMonth()+1}/${t.getDate()}/${t.getUTCFullYear()}`:ne},node(){var e;return(null===(e=this.resource)||void 0===e||null===(e=e.status)||void 0===e?void 0:e.nodeName)||ne},hostname(){var e,t;return(null===(e=this.resource)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.hostname)||(null===(t=this.resource)||void 0===t||null===(t=t.status)||void 0===t||null===(t=t.guestOSInfo)||void 0===t?void 0:t.hostname)},imageName(){var e;const t=this.$store.getters[d["b"]+"/all"](d["a"].IMAGE)||[],a=t.find(e=>this.value.rootImageId===e.id);return(null===a||void 0===a||null===(e=a.spec)||void 0===e?void 0:e.displayName)||"N/A"},disks(){var e;const t=(null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.domain)||void 0===e||null===(e=e.devices)||void 0===e?void 0:e.disks)||[];return t.filter(e=>!!e.bootOrder).sort((e,t)=>e.bootOrder<t.bootOrder?-1:1)},cdroms(){var e;const t=(null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.domain)||void 0===e||null===(e=e.devices)||void 0===e?void 0:e.disks)||[];return t.filter(e=>!!e.cdrom)},flavor(){var e,t,a;const s=null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.spec)||void 0===e?void 0:e.domain;return`${null===(t=s.cpu)||void 0===t?void 0:t.cores} vCPU , ${null===(a=s.resources)||void 0===a||null===(a=a.limits)||void 0===a?void 0:a.memory} ${this.t("harvester.virtualMachine.input.memory")}`},kernelRelease(){var e;return null===(e=this.resource)||void 0===e||null===(e=e.status)||void 0===e||null===(e=e.guestOSInfo)||void 0===e?void 0:e.kernelRelease},operatingSystem(){var e;return null===(e=this.resource)||void 0===e||null===(e=e.status)||void 0===e||null===(e=e.guestOSInfo)||void 0===e?void 0:e.prettyName},isDown(){return this.isEmpty(this.resource)},machineType(){var e;return(null===(e=this.value)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.template)||void 0===e||null===(e=e.spec)||void 0===e||null===(e=e.domain)||void 0===e||null===(e=e.machine)||void 0===e?void 0:e.type)||void 0}},methods:{getDeviceType(e){return e.disk?"Disk":"CD-ROM"},isEmpty(e){return void 0!==e&&0===Object.keys(e).length}}},de=oe,ue=(a("38d5"),Object(w["a"])(de,te,ae,!1,null,"ab09b78a",null)),ce=ue.exports,pe=function(){var e=this,t=e._self._c;return t("div",{staticClass:"overview-sshKeys"},e._l(e.sshKeys,(function(a,s){return t("div",{key:s,staticClass:"row overview-sshKeys__item"},[t("div",{staticClass:"col span-4"},[e._v(" "+e._s(a.id)+" ")]),t("div",{staticClass:"col span-7 offset-1"},[a.showKey?t("div",{staticClass:"key-display"},[e._v(" "+e._s(a.publicKey)+" "),t("button",{staticClass:"btn btn-sm role-link hide-bar",on:{click:function(t){return e.toggleShow(s)}}},[t("i",{staticClass:"icon icon-x"})])]):t("button",{staticClass:"btn btn-sm role-link",on:{click:function(t){return e.toggleShow(s)}}},[e._v(" *******"),t("i",{staticClass:"icons icon-show"})])])])})),0)},ve=[],me=a("9c38"),he=a.n(me),fe=a("4b06"),be={mixins:[fe["c"]],props:{value:{type:Object,required:!0}},async fetch(){const e=await Object(q["a"])({allSSHs:this.$store.dispatch(d["b"]+"/findAll",{type:d["a"].SSH})});this.allSSHs=e.allSSHs},data(){return{allSSHs:[],sshKeys:[]}},methods:{toggleShow(e){const t=this.sshKeys[e];this.$set(this.sshKeys,e,{...t,showKey:!t.showKey})},getKeys(){var e;return this.mergeAllSSHs(null===(e=this.value)||void 0===e?void 0:e.spec)},isShow(e=""){const t=this.sshKeys.find(t=>{var a;return(null===t||void 0===t||null===(a=t.data)||void 0===a?void 0:a.id)===e})||{};return t.showKey||!1}},watch:{allSSHs(e){const t=this.getKeys().map(e=>{var t;return{id:e.id,publicKey:he()(e.data)?e.data:null===(t=e.data)||void 0===t||null===(t=t.spec)||void 0===t?void 0:t.publicKey,showKey:this.isShow(e.id)}});this.$set(this,"sshKeys",t)}}},ge=be,ye=(a("69d1"),Object(w["a"])(ge,pe,ve,!1,null,"74e8faa7",null)),we=ye.exports;const Se="/api/v1/namespaces/cattle-monitoring-system/services/http:rancher-monitoring-grafana:80/proxy/d/harvester-vm-detail-1/vm-info-detail?orgId=1";var Ce={name:"VMIDetailsPage",components:{Tab:n["a"],Tabbed:l["a"],Events:ee,OverviewBasics:ce,Volume:H["a"],Network:G["a"],OverviewKeypairs:we,CloudConfig:K["a"],DashboardMetrics:B,AccessCredentials:F["a"]},mixins:[u["a"],c["c"]],props:{value:{type:Object,required:!0}},data(){return{switchToCloud:!1,VM_METRICS_DETAIL_URL:Se,showVmMetrics:!1}},async created(){const e={pods:this.$store.dispatch(d["b"]+"/findAll",{type:o["v"]}),services:this.$store.dispatch(d["b"]+"/findAll",{type:o["D"]}),events:this.$store.dispatch(d["b"]+"/findAll",{type:o["g"]}),allSSHs:this.$store.dispatch(d["b"]+"/findAll",{type:d["a"].SSH}),vmis:this.$store.dispatch(d["b"]+"/findAll",{type:d["a"].VMI})};await Object(q["a"])(e),this.showVmMetrics=await $(this.$store,this.currentCluster.id,[Se],"cluster")},computed:{...Object(r["a"])(["currentCluster"]),vmi(){const e=this.$store.getters[d["b"]+"/all"](d["a"].VMI)||[],t=e.find(e=>{var t,a;return(null===e||void 0===e||null===(t=e.metadata)||void 0===t||null===(t=t.ownerReferences)||void 0===t||null===(t=t[0])||void 0===t?void 0:t.uid)===(null===(a=this.value)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.uid)});return t},allEvents(){return this.$store.getters[d["b"]+"/all"](o["g"])},events(){return this.allEvents.filter(e=>{var t,a,s;const{name:i,creationTimestamp:r}=(null===(t=this.value)||void 0===t?void 0:t.metadata)||{},l=null===(a=this.value.podResource)||void 0===a||null===(a=a.metadata)||void 0===a?void 0:a.name,n=this.value.persistentVolumeClaimName||[],o=null===e||void 0===e||null===(s=e.involvedObject)||void 0===s?void 0:s.name,d=n.find(e=>e===o);return(o===i||o===l||d)&&e.firstTimestamp>=r}).sort((e,t)=>e.lastTimestamp>t.lastTimestamp?-1:1)},graphVars(){return{namespace:this.value.namespace,vm:this.value.name}},hasMetrics(){return!!this.$store.getters[d["b"]+"/byId"]("service","cattle-monitoring-system/rancher-monitoring-grafana")}},methods:{onTabChanged({tab:e}){var t;"cloudConfig"===e.name&&(null===(t=this.$refs.yamlEditor)||void 0===t||t.refresh())}},watch:{value:{handler(e){const t=this.getDiskRows(e);this.$set(this,"diskRows",t)},deep:!0}}},_e=Ce,ke=Object(w["a"])(_e,s,i,!1,null,null,null);t["default"]=ke.exports},"9f15":function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".grafana-graph[data-v-eeaaabda]{position:relative;min-height:100%;min-width:100%}.grafana-graph[data-v-eeaaabda] .content{position:relative;display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;height:100%;padding:0}.grafana-graph[data-v-eeaaabda] .overlay{position:static;background-color:initial}.grafana-graph iframe[data-v-eeaaabda]{position:absolute;left:0;right:0;top:20px;bottom:0;width:100%;height:100%;overflow:hidden}.grafana-graph iframe.loading[data-v-eeaaabda]{visibility:hidden}",""]),e.exports=t},"9f93":function(e,t,a){"use strict";a("74f9")},a42b:function(e,t,a){"use strict";a("52e1")},a858:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return e.showIP?t("div",e._l(e.ips,(function({ip:a,name:s}){return t("span",{key:a},[t("span",{directives:[{name:"tooltip",rawName:"v-tooltip",value:s,expression:"name"}]},[e._v(e._s(a))]),t("CopyToClipboard",{staticClass:"icon-btn",attrs:{text:a,"label-as":"tooltip","action-color":"bg-transparent"}})],1)})),0):e._e()},i=[],r=a("44f6"),l=a("e24b"),n=a("2cb5"),o=a("873f"),d=a("90cd"),u=a("6834"),c=a("e7e3"),p={components:{CopyToClipboard:c["a"]},props:{value:{type:String,default:""},row:{type:Object,required:!0},col:{type:Object,default:()=>{}}},data(){return{inStore:"harvester"}},created(){this.inStore=d["b"]},computed:{ips(){return[...this.vmiIp,...this.networkAnnotationIP].filter(Boolean).sort((e,t)=>e.ip<t.ip?-1:1)},networkAnnotationIP(){if("Running"!==this.row.actualState)return[];const e=Object(l["g"])(this.row,`metadata.annotations."${o["a"].NETWORK_IPS}"`)||"[]";try{const t=JSON.parse(e);return t.map(e=>({ip:e.replace(/\/[\d\D]*/,""),name:""}))}catch(t){return[]}},vmiIp(){var e,t;const a=this.$store.getters[this.inStore+"/all"](d["a"].VMI),s=a.find(e=>e.id===this.value)||null,i=this.row.networksName||[],r=(null===s||void 0===s||null===(e=s.spec)||void 0===e?void 0:e.networks)||[];return((null===s||void 0===s||null===(t=s.status)||void 0===t?void 0:t.interfaces)||[]).filter(e=>Object(n["k"])(e.ipAddress)&&i.includes(e.name)).map(e=>{let t;const a=r.find(t=>t.name===e.name);return a&&a.multus?t=a.multus.networkName:a&&a.pod&&(t=u["a"]),{ip:e.ipAddress,name:t}})},showIP(){return this.row.stateDisplay!==r["OFF"]}}},v=p,m=a("d802"),h=Object(m["a"])(v,s,i,!1,null,null,null);t["default"]=h.exports},a9ed:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".overview-sshKeys[data-v-74e8faa7]{text-align:left;max-height:700px;overflow:auto}.overview-sshKeys__item[data-v-74e8faa7]{margin-bottom:15px}.overview-sshKeys__item[data-v-74e8faa7]:last-child{margin-bottom:0}.overview-sshKeys .key-display[data-v-74e8faa7]{position:relative;padding-right:30px;word-break:break-word}.overview-sshKeys .key-display .hide-bar[data-v-74e8faa7]{position:absolute;top:-10px;right:10px}",""]),e.exports=t},aa1e:function(e,t,a){var s=a("d216");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("363ea8c4",s,!0,{sourceMap:!1,shadowMode:!1})},ad6d:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".yaml[data-v-6a2ca441]{height:350px;overflow:auto}[data-v-6a2ca441] .resource-yaml{flex:1;display:flex;flex-direction:column}[data-v-6a2ca441] .resource-yaml .yaml-editor{flex:1;min-height:350px}[data-v-6a2ca441] .resource-yaml .yaml-editor .code-mirror .CodeMirror{min-height:350px}",""]),e.exports=t},b661:function(e,t,a){"use strict";a("53ac")},b773:function(e,t,a){var s=a("e76d");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("70bc78b8",s,!0,{sourceMap:!1,shadowMode:!1})},ba30:function(e,t,a){"use strict";a("4be8")},c206:function(e,t,a){var s=a("20a9");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("de7e446a",s,!0,{sourceMap:!1,shadowMode:!1})},c31c:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".vm__credentials-users .hasUsers.labeled-select.edit.taggable .labeled-tooltip .icon.status-icon{top:30px}",""]),e.exports=t},cdb3:function(e,t,a){"use strict";a("d61a")},d216:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".consoleBut[data-v-ab09b78a]{position:relative;top:-20px;left:38px}.overview-basics[data-v-ab09b78a]{display:grid;grid-template-columns:100%;grid-template-rows:auto;grid-row-gap:15px}.overview-basics .badge-state[data-v-ab09b78a]{padding:2px 5px;font-size:12px;margin-right:3px}.overview-basics .smart-row[data-v-ab09b78a]{display:flex;flex-direction:row}.overview-basics .smart-row .console[data-v-ab09b78a]{display:flex}.overview-basics__name[data-v-ab09b78a]{flex:1}.overview-basics__ssh-key[data-v-ab09b78a]{min-width:150px}",""]),e.exports=t},d61a:function(e,t,a){var s=a("77b1");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("1450dfef",s,!0,{sourceMap:!1,shadowMode:!1})},d62a:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".volume-source[data-v-6386f148]{position:relative}.remove-vol[data-v-6386f148]{position:absolute;top:10px;right:10px;padding:0}",""]),e.exports=t},da72:function(e,t,a){var s=a("8e57");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("49b6180e",s,!0,{sourceMap:!1,shadowMode:!1})},db40:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"columns row"},[t("div",{staticClass:"col span-6"},[t("AccessCredentialsUsers",{attrs:{resource:e.resource,"user-options":e.userOptions,mode:e.mode,multiple:!0},on:{"update:user":e.updateUser,"update:newUser":e.updateNewUser},model:{value:e.value.users,callback:function(t){e.$set(e.value,"users",t)},expression:"value.users"}})],1),t("div",{staticClass:"col span-6"},[t("SSHKey",{staticClass:"mb-20",attrs:{namespace:e.resource.metadata.namespace,mode:e.mode,searchable:!1},on:{"update:sshKey":e.updateSSH},model:{value:e.value.sshkeys,callback:function(t){e.$set(e.value,"sshkeys",t)},expression:"value.sshkeys"}})],1)])])},i=[],r=a("2a79"),l=a("411b"),n={name:"HarvesterEditVolume",components:{SSHKey:r["a"],AccessCredentialsUsers:l["a"]},props:{mode:{type:String,default:"create"},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},methods:{update(){this.$emit("update")},updateUser(e){this.$set(this.value,"users",e),this.update()},updateSSH(e){this.$set(this.value,"sshkeys",e),this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},o=n,d=a("d802"),u=Object(d["a"])(o,s,i,!1,null,null,null);t["default"]=u.exports},df1c:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-type"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.type"),value:e.value.type,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.type"),options:e.VOLUME_TYPE,mode:e.mode},on:{input:e.update},model:{value:e.value.type,callback:function(t){e.$set(e.value,"type",t)},expression:"value.type"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-image"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.image"),value:e.imageName,mode:e.mode}},[t("LabeledSelect",{attrs:{disabled:0===e.idx&&!e.isCreate&&!e.value.newCreateId&&e.isVirtualType,label:e.t("harvester.fields.image"),options:e.imagesOption,mode:e.mode,searchable:!0,required:e.validateRequired},on:{input:e.onImageChange},model:{value:e.value.image,callback:function(t){e.$set(e.value,"image",t)},expression:"value.image"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hevi-size"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.size"),value:e.value.size,mode:e.mode}},[t("UnitInput",{attrs:{"output-modifier":!0,increment:1024,"input-exponent":3,label:e.t("harvester.fields.size"),mode:e.mode,min:10,required:e.validateRequired,suffix:"GiB"},on:{input:e.update},model:{value:e.value.size,callback:function(t){e.$set(e.value,"size",t)},expression:"value.size"}})],1)],1)]),t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-3",attrs:{"data-testid":"input-hevi-bus"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.virtualMachine.volume.bus"),value:e.value.bus,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.virtualMachine.volume.bus"),mode:e.mode,options:e.InterfaceOption},on:{input:e.update},model:{value:e.value.bus,callback:function(t){e.$set(e.value,"bus",t)},expression:"value.bus"}})],1)],1)])])},i=[],r=a("bddd"),l=a("4978"),n=a("8e93"),o=a("466b"),d=a("5361"),u=a("907c"),c=a("90cd"),p=a("d37d"),v=a("7c47"),m={name:"HarvesterEditVMImage",components:{UnitInput:l["a"],LabeledInput:n["a"],LabeledSelect:o["a"],InputOrDisplay:d["a"]},props:{value:{type:Object,default:()=>({})},namespace:{type:String,default:null},mode:{type:String,default:"create"},idx:{type:Number,required:!0},isCreate:{type:Boolean,default:!0},isEdit:{type:Boolean,default:!1},validateRequired:{type:Boolean,required:!0},isVirtualType:{type:Boolean,default:!0}},data(){return{VOLUME_TYPE:v["e"],InterfaceOption:v["b"],loading:!1,images:[]}},fetch(){this.images=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE)},computed:{imagesOption(){return this.images.filter(e=>e.isReady).sort((e,t)=>e.creationTimestamp>t.creationTimestamp?-1:1).map(e=>({label:`${e.metadata.namespace}/${e.spec.displayName}`,value:e.id}))},imageName(){const e=this.imagesOption.find(e=>e.value===this.value.image);return e?e.label:"-"},pvcsResource(){const e=this.$store.getters[c["b"]+"/all"](u["y"])||[];return e.find(e=>!this.namespace||e.id===`${this.namespace}/${this.value.volumeName}`)}},watch:{"value.type"(e){"cd-rom"===e&&(this.$set(this.value,"bus","sata"),this.update())},"value.image"(e){this.checkImageExists(e)},imagesOption(){this.checkImageExists(this.value.image)},pvcsResource:{handler(e){var t;if(null!==e&&void 0!==e&&null!==(t=e.spec)&&void 0!==t&&null!==(t=t.resources)&&void 0!==t&&null!==(t=t.requests)&&void 0!==t&&t.storage&&this.isVirtualType){const t=Object(p["d"])(e.spec.resources.requests.storage),a=Object(p["c"])(t,{increment:1024,addSuffix:!1,maxExponent:3,minExponent:3});this.value.size=a+"Gi"}},deep:!0,immediate:!0}},methods:{update(){this.$emit("update")},onImageChange(){var e;const t=null===(e=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE))||void 0===e?void 0:e.find(e=>this.value.image===e.id);0===this.idx&&(/iso$/i.test(null===t||void 0===t?void 0:t.imageSuffix)?(this.$set(this.value,"type","cd-rom"),this.$set(this.value,"bus","sata")):(this.$set(this.value,"type","disk"),this.$set(this.value,"bus","virtio"))),this.update()},onOpen(){this.images=this.$store.getters[c["b"]+"/all"](c["a"].IMAGE)},checkImageExists(e){e&&this.imagesOption.length>0&&!Object(r["e"])(this.imagesOption,"value",e)&&(this.$store.dispatch("growl/error",{title:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.title",{name:e}),message:this.$store.getters["i18n/t"]("harvester.vmTemplate.tips.notExistImage.message")},{root:!0}),this.$set(this.value,"image",""))}}},h=m,f=a("d802"),b=Object(f["a"])(h,s,i,!1,null,null,null);t["default"]=b.exports},e299:function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"row",on:{input:e.update}},[t("div",{staticClass:"col span-6"},[t("AccessCredentialsUsers",{attrs:{resource:e.resource,"user-options":e.userOptions,multiple:!1,mode:e.mode},on:{"update:user":e.updateUser,"update:newUser":e.updateNewUser},model:{value:e.value.username,callback:function(t){e.$set(e.value,"username",t)},expression:"value.username"}})],1),t("div",{staticClass:"col span-6"},[t("Password",{ref:"password",attrs:{mode:e.mode,disabled:"edit"!==e.mode,label:e.t("harvester.virtualMachine.input.password"),required:""},model:{value:e.value.newPassword,callback:function(t){e.$set(e.value,"newPassword",t)},expression:"value.newPassword"}})],1)])},i=[],r=a("6b77"),l=a("411b"),n={name:"HarvesterEditVolume",components:{Password:r["a"],AccessCredentialsUsers:l["a"]},props:{mode:{type:String,default:"create"},resource:{type:Object,default:()=>({})},userOptions:{type:Array,default:()=>[]},value:{type:Object,default:()=>({})}},data(){return{defaultPwdValue:{username:"",newPassword:""}}},methods:{update(){this.$emit("update")},updateUser(e){this.$set(this.value,"username",e),this.update()},updateNewUser(e){this.$emit("update:newUser",e)}}},o=n,d=(a("ff41"),a("d802")),u=Object(d["a"])(o,s,i,!1,null,"4ed320b6",null);t["default"]=u.exports},e76d:function(e,t,a){var s=a("5eaa");t=s(!1),t.push([e.i,".copy-to-clipboard-text.plain[data-v-f6a2b8be]{color:var(--body-text)}.copy-to-clipboard-text.plain[data-v-f6a2b8be]:hover{text-decoration:none}.copy-to-clipboard-text.copied[data-v-f6a2b8be]{pointer-events:none;color:var(--success)}",""]),e.exports=t},fbc9:function(e,t,a){var s=a("6c40");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("04e6e81f",s,!0,{sourceMap:!1,shadowMode:!1})},fbd4:function(e,t,a){"use strict";a("6306")},fc40:function(e,t,a){var s=a("c31c");s.__esModule&&(s=s.default),"string"===typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);var i=a("0ed3").default;i("058ecdf6",s,!0,{sourceMap:!1,shadowMode:!1})},fcd5:function(e,t,a){"use strict";a("c206")},fea5:function(e,t,a){"use strict";var s=function(){var e=this,t=e._self._c;return t("div",[e._l(e.rows,(function(a,s){return t("InfoBox",{key:s,staticClass:"infoBox"},[e.isView?e._e():t("button",{staticClass:"role-link remove-vol",attrs:{type:"button"},on:{click:function(t){return e.remove(a)}}},[t("i",{staticClass:"icon icon-x"})]),t("h3",[e._v(" "+e._s(e.t("harvester.virtualMachine.network.title"))+" ")]),t("Base",{key:e.rows[s].rowKeyId,attrs:{rows:e.rows,mode:e.mode,namespace:e.namespace,"is-single":e.isSingle,"network-option":e.networkOption},on:{update:e.update},model:{value:e.rows[s],callback:function(t){e.$set(e.rows,s,t)},expression:"rows[i]"}})],1)})),e.isView?e._e():t("button",{staticClass:"btn btn-sm bg-primary",attrs:{type:"button"},on:{click:e.add}},[e._v(" "+e._s(e.t("harvester.virtualMachine.network.addNetwork"))+" ")])],2)},i=[],r=a("13a9"),l=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"row mb-20"},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-name"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.name"),value:e.value.name,mode:e.mode}},[t("LabeledInput",{attrs:{label:e.t("harvester.fields.name"),required:"",mode:e.mode,disabled:e.isDisabled},on:{input:e.update},model:{value:e.value.name,callback:function(t){e.$set(e.value,"name",t)},expression:"value.name"}})],1)],1),t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-model"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.model"),value:e.value.model,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.model"),disabled:e.isDisabled,options:e.modelOption,mode:e.mode,required:""},on:{input:e.update},model:{value:e.value.model,callback:function(t){e.$set(e.value,"model",t)},expression:"value.model"}})],1)],1)]),t("div",{staticClass:"row",class:{"mb-20":!e.isMasquerade}},[t("div",{staticClass:"col span-6",attrs:{"data-testid":"input-hen-networkName"}},[t("InputOrDisplay",{attrs:{name:e.t("harvester.fields.network"),value:e.value.networkName,mode:e.mode}},[t("LabeledSelect",{attrs:{label:e.t("harvester.fields.network"),options:e.allNetworkOption,mode:e.mode,required:"",disabled:e.isDisabled},on:{input:e.updateNetworkName},model:{value:e.value.networkName,callback:function(t){e.$set(e.value,"networkName",t)},expression:"value.networkName"}})],1)],1)])])},n=[],o=a("5361"),d=a("8e93"),u=a("466b"),c=a("e24b"),p=a("da25"),v=a("6834");const m=[{label:"virtio",value:"virtio"},{label:"e1000",value:"e1000"}];var h={name:"HarvesterEditNetwork",components:{LabeledInput:d["a"],LabeledSelect:u["a"],InputOrDisplay:o["a"]},props:{value:{type:Object,default:()=>({})},networkOption:{type:Array,default:()=>[]},rows:{type:Array,default:()=>[]},mode:{type:String,default:"create"},isSingle:{type:Boolean,default:!0},namespace:{type:String,default:null}},data(){const e=this.value.isPod;return e&&(this.value.networkName=v["a"]),{isMasquerade:e,hasManagementNetwork:!1,showAdvanced:!1}},computed:{isDisabled(){return"podnet"===this.value.name||this.isMasquerade&&!this.value.newCreateId&&!this.isCreate},isView(){return this.mode===p["w"]},isCreate(){return this.mode===p["n"]},modelOption(){return m},allNetworkOption(){const e=Object(c["e"])(this.networkOption).filter(e=>e.label.includes(this.namespace)),t=[{label:v["a"],value:v["a"]}];return this.value.newCreateId&&this.hasManagementNetwork?e:this.isMasquerade?t:e}},watch:{rows:{handler(e){const t=!!e.some(e=>e.isPod);this.$set(this,"hasManagementNetwork",t)},immediate:!0,deep:!0},isSingle(e){e||(this.$set(this.value,"macAddress",""),this.update())}},methods:{updateNetworkName(e){e===v["a"]?(this.value.isPod=!0,this.value.macAddress=""):this.value.isPod=!1,this.$set(this,"isMasquerade",this.value.isPod),this.value.isPod?this.value.type="masquerade":this.value.type="macvtap",this.update()},update(){this.$emit("update")},toggleAdvanced(){this.showAdvanced=!this.showAdvanced}}},f=h,b=a("d802"),g=Object(b["a"])(f,l,n,!1,null,null,null),y=g.exports,w=a("907c"),S=a("873f"),C=a("1d19"),_=a("2cb5"),k=a("bddd"),O=a("90cd"),I={components:{InfoBox:r["a"],Base:y},props:{mode:{type:String,default:"create"},value:{type:Array,default:()=>[]},namespace:{type:String,default:null},isSingle:{type:Boolean,default:!0}},data(){return{rows:this.addKeyId(Object(c["e"])(this.value)),nameIdx:1}},computed:{isView(){return this.mode===p["w"]},networkOption(){const e=this.$store.getters[O["b"]+"/all"](w["r"]).filter(e=>{var t;return!(null!==(t=e.metadata)&&void 0!==t&&null!==(t=t.annotations)&&void 0!==t&&t[S["a"].STORAGE_NETWORK])}),t=Object(C["a"])(e.map(e=>{const t=e.id;return{label:t,value:e.metadata.name}}),"label");return t}},watch:{value(e){this.rows=e}},methods:{add(e){const t=this.generateName(),a={name:t,networkName:"",model:"virtio",type:"bridge",newCreateId:Object(_["p"])(10),rowKeyId:Object(_["p"])(10)};this.rows.push(a),this.update()},remove(e){Object(k["i"])(this.rows,e),this.update()},addKeyId(e){return e.map(e=>({...e,rowKeyId:Object(_["p"])(10)}))},generateName(){let e="",t=!0;while(t)e="nic-"+this.nameIdx,t=this.rows.find(t=>t.name===e),this.nameIdx++;return e},update(){this.$emit("input",this.rows)}}},E=I,M=(a("cdb3"),Object(b["a"])(E,s,i,!1,null,"b57c60be",null));t["a"]=M.exports},ff41:function(e,t,a){"use strict";a("1eec")}}]);
//# sourceMappingURL=harvester-ift-0.2.0.umd.min.detail.js.map